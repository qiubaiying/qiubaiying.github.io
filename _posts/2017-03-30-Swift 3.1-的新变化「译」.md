---
layout:     post
title:      Swift 3.1 çš„æ–°å˜åŒ–ã€Œè¯‘ã€
subtitle:   Whatâ€™s New in Swift 3.1?
date:       2017-03-30
author:     BY
header-img: img/post-bg-iWatch.jpg
catalog: true
tags:
    - iOS
    - Swift
    - Xcode
---


![](https://koenig-media.raywenderlich.com/uploads/2017/03/WhatsNewSwift3.1-feature-1-250x250.png)

Xcode 8.3 å’Œ Swift 3.1 ç°åœ¨å·²ç»å‘å¸ƒäº†(3/28)ï¼

å¯ä»¥é€šè¿‡ [AppStore](https://itunes.apple.com/us/app/xcode/id497799835?ls=1&mt=12#) æˆ– [Apple Developer](https://developer.apple.com/download/more/) è¿›è¡Œä¸‹è½½

![](https://ww2.sinaimg.cn/large/006tNbRwgy1fe2it3xwt6j30s50g3mya.jpg)

Xcode 8.3 ä¼˜åŒ–äº† Objective-C ä¸ Swift æ··ç¼–é¡¹ç›®çš„ç¼–è¯‘é€Ÿåº¦.

Swift 3.1 ç‰ˆæœ¬åŒ…å«ä¸€äº›æœŸå¾…å·²ä¹…çš„ [Swift package manager](https://github.com/apple/swift-package-manager) åŠŸèƒ½å’Œè¯­æ³•æœ¬èº«çš„æ”¹è¿›ã€‚

å¦‚æœæ‚¨æ²¡æœ‰å¯†åˆ‡å…³æ³¨ [Swift Evolution](https://github.com/apple/swift-evolution) è¿›ç¨‹ï¼Œè¯·ç»§ç»­é˜…è¯» - æœ¬æ–‡éå¸¸é€‚åˆæ‚¨ï¼

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†å¼ºè°ƒSwift 3.1ä¸­æœ€é‡è¦çš„å˜åŒ–ï¼Œè¿™å°†å¯¹æ‚¨çš„ä»£ç äº§ç”Ÿé‡å¤§å½±å“ã€‚æˆ‘ä»¬æ¥å§ï¼ğŸ˜ƒ

## å¼€å§‹

Swift 3.1ä¸Swift 3.0æºä»£ç å…¼å®¹ï¼Œå› æ­¤å¦‚æœæ‚¨å·²ç»ä½¿ç”¨Xcode ä¸­çš„ `Edit \ Convert \ To Current Swift Syntax ...` å°†é¡¹ç›®è¿ç§»åˆ°Swift 3.0ï¼Œæ–°åŠŸèƒ½å°†ä¸ä¼šç ´åæ‚¨çš„ä»£ç ã€‚ä¸è¿‡ï¼Œè‹¹æœå·²ç»åœ¨Xcode 8.3ä¸­æ”¯æŒSwift 2.3ã€‚æ‰€ä»¥å¦‚æœä½ è¿˜æ²¡æœ‰ä»Swift 2.3è¿ç§»ï¼Œç°åœ¨æ˜¯æ—¶å€™è¿™æ ·åšäº†ï¼

åœ¨ä¸‹é¢çš„éƒ¨åˆ†ï¼Œæ‚¨ä¼šçœ‹åˆ°é“¾æ¥çš„æ ‡ç­¾ï¼Œå¦‚`[SE-0001]`ã€‚è¿™äº›æ˜¯ [Swift Evolution](https://apple.github.io/swift-evolution/) ææ¡ˆå·ç ã€‚æˆ‘å·²ç»åˆ—å‡ºäº†æ¯ä¸ªææ¡ˆçš„é“¾æ¥ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥å‘ç°æ¯ä¸ªç‰¹å®šæ›´æ”¹çš„å®Œæ•´è¯¦ç»†ä¿¡æ¯ã€‚æˆ‘å»ºè®®æ‚¨å°è¯•åœ¨Playgroundä¸ŠéªŒè¯æ–°çš„åŠŸèƒ½ï¼Œä»¥ä¾¿æ›´å¥½åœ°äº†è§£æ‰€æœ‰æ›´æ”¹çš„å†…å®¹ã€‚

> Note:å¦‚æœä½ æƒ³äº†è§£ swift 3.0 ä¸­çš„æ–°åŠŸèƒ½ï¼Œå¯ä»¥çœ‹[è¿™ç¯‡æ–‡ç« ](https://www.raywenderlich.com/135655/whats-new-swift-3)ã€‚

## è¯­æ³•æ”¹è¿›

é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªç‰ˆæœ¬ä¸­çš„è¯­æ³•æ”¹è¿›ï¼ŒåŒ…æ‹¬å…³äºæ•°å€¼ç±»å‹çš„`å¯å¤±è´¥æ„é€ å™¨`ï¼ˆ`Failable Initializers`ï¼‰ï¼Œæ–°çš„åºåˆ—å‡½æ•°ç­‰ç­‰ã€‚

#### å¯å¤±è´¥çš„æ•°å€¼è½¬æ¢æ„é€ å™¨ï¼ˆFailable Numeric Conversion Initializersï¼‰

Swift 3.1 ä¸ºæ‰€æœ‰æ•°å€¼ç±»å‹ `(Int, Int8, Int16, Int32, Int64, UInt, UInt8, UInt16, UInt32, UInt64, Float, Float80, Double)` æ·»åŠ äº†[å¯å¤±è´¥æ„é€ å™¨](https://www.swiftmi.com/topic/121.html)ã€‚

è¿™ä¸ªåŠŸèƒ½éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚ï¼Œä»¥å®‰å…¨ã€å¯æ¢å¤çš„æ–¹å¼å¤„ç†å¤–æºæ¾æ•£ç±»å‹æ•°æ®çš„è½¬æ¢ï¼Œä¸‹é¢æ¥çœ‹ Student çš„ JSON æ•°ç»„çš„å¤„ç†ï¼š

```swift
class Student {
  let name: String
  let grade: Int
 
  init?(json: [String: Any]) {
    guard let name = json["name"] as? String,
          let gradeString = json["grade"] as? String,
          let gradeDouble = Double(gradeString),
          let grade = Int(exactly: gradeDouble)  // <-- 3.1 çš„æ”¹åŠ¨åœ¨è¿™
    else {
        return nil
    }
    self.name = name
    self.grade = grade
  }
}
 
func makeStudents(with data: Data) -> [Student] {
  guard let json = try? JSONSerialization.jsonObject(with: data, options: .allowFragments),
        let jsonArray = json as? [[String: Any]] else {
    return []
  }
  return jsonArray.flatMap(Student.init)
}
 
let rawStudents = "[{\"name\":\"Ray\", \"grade\":\"5.0\"}, {\"name\":\"Matt\", \"grade\":\"6\"},
                    {\"name\":\"Chris\", \"grade\":\"6.33\"}, {\"name\":\"Cosmin\", \"grade\":\"7\"}, 
                    {\"name\":\"Steven\", \"grade\":\"7.5\"}]"
let data = rawStudents.data(using: .utf8)!
let students = makeStudents(with: data)
dump(students) // [(name: "Ray", grade: 5), (name: "Matt", grade: 6), (name: "Cosmin", grade: 7)]
```
åœ¨ `Student` ç±»ä¸­ä½¿ç”¨äº†ä¸€ä¸ªå¯å¤±è´¥æ„é€ å™¨å°† `grade` å±æ€§ä» `Double ` è½¬å˜ä¸º `Int`ï¼Œåƒè¿™æ ·

```swift
let grade = Int(exactly: gradeDouble)
```

å¦‚æœ`gradeDouble`ä¸æ˜¯æ•´æ•°ï¼Œä¾‹å¦‚6.33ï¼Œå®ƒå°†å¤±è´¥ã€‚å¦‚æœå®ƒå¯ä»¥ç”¨ä¸€ä¸ªæ­£ç¡®çš„è¡¨ç¤ºIntï¼Œä¾‹å¦‚6.0ï¼Œå®ƒå°†æˆåŠŸã€‚

> Noteï¼šè™½ç„¶`throwing initializers` å¯ä»¥ç”¨æ¥æ›¿ä»£ `failable initializers`ã€‚ä½†æ˜¯ä½¿ç”¨ `failable initializers` ä¼šæ›´å¥½ï¼Œæ›´ç¬¦åˆäººçš„æ€ç»´ã€‚

##### æ–°çš„åºåˆ—å‡½æ•°ï¼ˆSequence Functionsï¼‰

swift3.1æ·»åŠ äº†ä¸¤ä¸ªæ–°çš„æ ‡å‡†åº“å‡½æ•°åœ¨ `Sequence` åè®®ä¸­ï¼š`prefix(while:)``å’Œprefix(while:)`[[SE-0045]](https://github.com/apple/swift-evolution/blob/master/proposals/0045-scan-takewhile-dropwhile.md)ã€‚

æ„é€ ä¸€ä¸ª[æ–æ³¢çº³å¥‘](https://en.wikipedia.org/wiki/Fibonacci_number)æ— é™åºåˆ—ï¼š

```swift
let fibonacci = sequence(state: (0, 1)) {
  (state: inout (Int, Int)) -> Int? in
  defer {state = (state.1, state.0 + state.1)}
  return state.0
}
```

åœ¨Swift 3.0ä¸­ï¼Œæ‚¨åªéœ€æŒ‡å®š`è¿­ä»£æ¬¡æ•°`å³å¯éå†fibonacciåºåˆ—ï¼š

```swift
// Swift 3.0
for number in fibonacci.prefix(10) {
  print(number)  // 0 1 1 2 3 5 8 13 21 34
}
```

åœ¨swift 3.1ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`prefix(while:)`å’Œ`drop(while:)`è·å¾—ç¬¦åˆæ¡ä»¶åœ¨ä¸¤ä¸ªç»™å®šå€¼ä¹‹é—´çš„åºåˆ—ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå°±åƒè¿™æ ·ï¼š

```swift
// Swift 3.1
let interval = fibonacci.prefix(while: {$0 < 1000}).drop(while: {$0 < 100})
for element in interval {
  print(element) // 144 233 377 610 987
}
```

`prefix(while:)`è¿”å›æ»¡è¶³æŸä¸ªè°“è¯çš„æœ€é•¿å­åºåˆ—ã€‚å®ƒä»åºåˆ—çš„å¼€å¤´å¼€å§‹ï¼Œå¹¶åœåœ¨ç»™å®šé—­åŒ…è¿”å›falseçš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸Šã€‚

`drop(while:)` ç›¸åï¼šå®ƒè¿”å›ä»ç»™å®šå…³é—­è¿”å›falseçš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹çš„å­åºåˆ—ï¼Œå¹¶åœ¨åºåˆ—ç»“å°¾å®Œæˆã€‚

> Note:è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨å°¾éšé—­åŒ…çš„å†™æ³•ï¼š
> 
> ```swift
> let interval = fibonacci.prefix{$0 < 1000}.drop{$0 < 100}
> ```


## Concrete Constrained Extensionsï¼ˆå§‘ä¸”ç¿»è¯‘ä¸ºç±»çš„çº¦æŸæ‰©å±•å§ï¼‰

Swift 3.1å…è®¸æ‚¨æ‰©å±•å…·æœ‰ç±»å‹çº¦æŸçš„é€šç”¨ç±»å‹ã€‚ä»¥å‰ï¼Œä½ ä¸èƒ½åƒè¿™æ ·æ‰©å±•ç±»å‹ï¼Œå› ä¸ºçº¦æŸå¿…é¡»æ˜¯ä¸€ä¸ªåè®®ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚

ä¾‹å¦‚ï¼ŒRuby on Railsæä¾›äº†ä¸€ç§`isBlank`æ£€æŸ¥ç”¨æˆ·è¾“å…¥çš„éå¸¸æœ‰ç”¨çš„æ–¹æ³•ã€‚ä»¥ä¸‹æ˜¯åœ¨Swift 3.0ä¸­ç”¨ `String` ç±»å‹çš„æ‰©å±•å®ç°è¿™ä¸ª**è®¡ç®—å‹å±æ€§**ï¼š

```swift
// Swift 3.0
extension String {
  var isBlank: Bool {
    return trimmingCharacters(in: .whitespaces).isEmpty
  }
}
 
let abc = " "
let def = "x"
 
abc.isBlank // true
def.isBlank // false
```

å¦‚æœä½ å¸Œæœ›`isBlank`è®¡ç®—å‹å±æ€§ä¸ºä¸€ä¸ªå¯é€‰å€¼æ‰€ç”¨ï¼Œåœ¨swift 3.0ä¸­ï¼Œä½ å°†è¦è¿™æ ·åš

```swift
// Swift 3.0
protocol StringProvider {
  var string: String {get}
}
 
extension String: StringProvider {
  var string: String {
    return self
  }
}
 
extension Optional where Wrapped: StringProvider {
  var isBlank: Bool {
    return self?.string.isBlank ?? true
  }
}
 
let foo: String? = nil
let bar: String? = "  "
let baz: String? = "x"
 
foo.isBlank // true
bar.isBlank // true
baz.isBlank // false
```

è¿™åˆ›å»ºäº†ä¸€ä¸ªé‡‡ç”¨ `String` çš„ `StringProvider` åè®®è€Œåœ¨ä½ ä½¿ç”¨StringProvideræ‰©å±•å¯é€‰çš„ wrapped ç±»å‹æ—¶,æ·»åŠ isBlankæ–¹æ³•ã€‚

Swift 3.1ä¸­ï¼Œç”¨æ¥æ›¿ä»£åè®®æ–¹æ³•ï¼Œæ‰©å±•å…·ä½“ç±»å‹çš„æ–¹æ³•åƒè¿™æ ·ï¼š

```swift
// Swift 3.1
extension Optional where Wrapped == String {
  var isBlank: Bool {
    return self?.isBlank ?? true
  }
}
```
è¿™å°±ç”¨æ›´å°‘çš„ä»£ç å®ç°äº†å’ŒåŸå…ˆç›¸åŒçš„åŠŸèƒ½~

## æ³›å‹åµŒå¥—ï¼ˆNested Genericsï¼‰

Swift 3.1å…è®¸æ‚¨å°†åµŒå¥—ç±»å‹ä¸æ³›å‹æ··åˆã€‚ä½œä¸ºä¸€ä¸ªç»ƒä¹ ï¼Œè€ƒè™‘è¿™ä¸ªï¼ˆä¸æ˜¯å¤ªç–¯ç‹‚ï¼‰çš„ä¾‹å­ã€‚æ¯å½“æŸä¸ªå›¢é˜Ÿé¢†å¯¼raywenderlich.comæƒ³åœ¨åšå®¢ä¸Šå‘å¸ƒä¸€ç¯‡æ–‡ç« æ—¶ï¼Œä»–ä¼šåˆ†é…ä¸€æ‰¹ä¸“é—¨çš„å¼€å‘äººå‘˜æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œä»¥æ»¡è¶³ç½‘ç«™çš„é«˜è´¨é‡æ ‡å‡†ï¼š

```swift
class Team<T> {
  enum TeamType {
    case swift
    case iOS
    case macOS
  }
 
  class BlogPost<T> {
    enum BlogPostType {
      case tutorial
      case article
    }
 
    let title: T
    let type: BlogPostType
    let category: TeamType
    let publishDate: Date
 
    init(title: T, type: BlogPostType, category: TeamType, publishDate: Date) {
      self.title = title
      self.type = type
      self.category = category
      self.publishDate = publishDate
    }
  }
 
  let type: TeamType
  let author: T
  let teamLead: T
  let blogPost: BlogPost<T>
 
  init(type: TeamType, author: T, teamLead: T, blogPost: BlogPost<T>) {
    self.type = type
    self.author = author
    self.teamLead = teamLead
    self.blogPost = blogPost
  }
}
```

å°†`BlogPost`å†…éƒ¨ç±»åµŒå¥—åœ¨å…¶å¯¹åº”çš„`Team`å¤–éƒ¨ç±»ä¸­ï¼Œå¹¶ä½¿ä¸¤ä¸ªç±»éƒ½é€šç”¨ã€‚è¿™æ˜¯å›¢é˜Ÿå¦‚ä½•å¯»æ‰¾æˆ‘åœ¨ç½‘ç«™ä¸Šå‘å¸ƒçš„æ•™ç¨‹å’Œæ–‡ç« ï¼š

```swift
Team(type: .swift, author: "Cosmin PupÄƒzÄƒ", teamLead: "Ray Fix", 
     blogPost: Team.BlogPost(title: "Pattern Matching", type: .tutorial, 
     category: .swift, publishDate: Date()))
 
Team(type: .swift, author: "Cosmin PupÄƒzÄƒ", teamLead: "Ray Fix", 
     blogPost: Team.BlogPost(title: "What's New in Swift 3.1?", type: .article, 
     category: .swift, publishDate: Date()))
```

ä½†å®é™…ä¸Šï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ç®€åŒ–è¯¥ä»£ç ã€‚å¦‚æœåµŒå¥—çš„å†…éƒ¨ç±»å‹ä½¿ç”¨é€šç”¨å¤–éƒ¨ç±»å‹ï¼Œé‚£ä¹ˆå®ƒé»˜è®¤ç»§æ‰¿çˆ¶ç±»çš„ç±»å‹ã€‚å› æ­¤ï¼Œæ‚¨ä¸éœ€è¦å¦‚æ­¤å£°æ˜ï¼š

```swift
class Team<T> {
  // original code 
 
  class BlogPost {
    // original code
  }  
 
  // original code 
  let blogPost: BlogPost
 
  init(type: TeamType, author: T, teamLead: T, blogPost: BlogPost) {
    // original code   
  }
}
```

> Noteï¼šå¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äºSwiftä¸­çš„**æ³›å‹**ï¼Œè¯·é˜…è¯»æˆ‘ä»¬æœ€è¿‘æ›´æ–°çš„[Swiftæ³›å‹å…¥é—¨çš„æ•™ç¨‹](https://www.raywenderlich.com/154371/swift-generics-tutorial-getting-started)ã€‚

##  Swiftç‰ˆæœ¬çš„å¯ç”¨æ€§

æ‚¨å¯ä»¥ä½¿ç”¨**#if swift(>= N)** `é™æ€æ„é€ `æ¥æ£€æŸ¥ç‰¹å®šçš„Swiftç‰ˆæœ¬ï¼š

```swift
// Swift 3.0
#if swift(>=3.1)
  func intVersion(number: Double) -> Int? {
    return Int(exactly: number)
  }
#elseif swift(>=3.0)
  func intVersion(number: Double) -> Int {
    return Int(number)
  }
#endif
```

ç„¶è€Œï¼Œå½“ä½¿ç”¨Swiftæ ‡å‡†åº“æ—¶ï¼Œè¿™ç§æ–¹æ³•æœ‰ä¸€ä¸ªä¸»è¦ç¼ºç‚¹ã€‚å®ƒéœ€è¦ä¸ºæ¯ä¸ªå—æ”¯æŒçš„æ—§è¯­è¨€ç‰ˆæœ¬ç¼–è¯‘æ ‡å‡†åº“ã€‚è¿™æ˜¯å› ä¸ºå½“æ‚¨ä»¥å‘åå…¼å®¹æ¨¡å¼è¿è¡ŒSwiftç¼–è¯‘å™¨æ—¶ï¼Œä¾‹å¦‚æ‚¨è¦ä½¿ç”¨Swift 3.0è¡Œä¸ºï¼Œåˆ™éœ€è¦ä½¿ç”¨é’ˆå¯¹è¯¥ç‰¹å®šå…¼å®¹æ€§ç‰ˆæœ¬ç¼–è¯‘çš„æ ‡å‡†åº“ç‰ˆæœ¬ã€‚å¦‚æœæ‚¨ä½¿ç”¨ç‰ˆæœ¬3.1æ¨¡å¼ç¼–è¯‘çš„ï¼Œé‚£ä¹ˆæ‚¨æ ¹æœ¬å°±æ²¡æœ‰æ­£ç¡®çš„ä»£ç 

å› æ­¤ï¼Œ@availableé™¤äº†ç°æœ‰å¹³å°ç‰ˆæœ¬ [[SE-0141]](https://github.com/apple/swift-evolution/blob/master/proposals/0141-available-by-swift-version.md) ä¹‹å¤–ï¼ŒSwift 3.1æ‰©å±•äº†è¯¥å±æ€§ä»¥æ”¯æŒæŒ‡å®šSwiftç‰ˆæœ¬å·ï¼š

```swift
// Swift 3.1
 
@available(swift 3.1)
func intVersion(number: Double) -> Int? {
  return Int(exactly: number)
}
 
@available(swift, introduced: 3.0, obsoleted: 3.1)
func intVersion(number: Double) -> Int {
  return Int(number)
}
```

è¿™ä¸ªæ–°åŠŸèƒ½æä¾›äº†ä¸`intVersionSwift`ç‰ˆæœ¬æœ‰å…³çš„æ–¹æ³•ç›¸åŒçš„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œå®ƒåªå…è®¸åƒæ ‡å‡†åº“è¿™æ ·çš„åº“è¢«ç¼–è¯‘ä¸€æ¬¡ã€‚ç¼–è¯‘å™¨ç„¶åç®€å•åœ°é€‰æ‹©å¯ç”¨äºæ‰€é€‰æ‹©çš„ç»™å®šå…¼å®¹æ€§ç‰ˆæœ¬çš„åŠŸèƒ½ã€‚

> Noteï¼šæ³¨æ„ï¼šå¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äºSwift çš„`å¯ç”¨æ€§å±æ€§ï¼ˆ availability attributesï¼‰`ï¼Œè¯·å‚é˜…æˆ‘ä»¬å…³äº[Swiftä¸­å¯ç”¨æ€§å±æ€§çš„æ•™ç¨‹](https://www.raywenderlich.com/139077/availability-attributes-swift)ã€‚

## é€ƒé€¸é—­åŒ…ï¼ˆEscaping Closuresï¼‰

åœ¨Swift 3.0 [[ SE-0103 ]](https://github.com/apple/swift-evolution/blob/master/proposals/0103-make-noescape-default.md) ä¸­å‡½æ•°ä¸­çš„é—­åŒ…çš„å‚æ•°æ˜¯é»˜è®¤æ˜¯ä¸é€ƒé€¸çš„ï¼ˆnon-escapingï¼‰ã€‚åœ¨Swift 3.1ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ–°çš„å‡½æ•°`withoutActuallyEscaping()`å°†éé€ƒé€¸é—­åŒ…è½¬æ¢ä¸ºä¸´æ—¶é€ƒé€¸ã€‚

```swift
func perform(_ f: () -> Void, simultaneouslyWith g: () -> Void,
             on queue: DispatchQueue) {
  withoutActuallyEscaping(f) { escapableF in     // 1
    withoutActuallyEscaping(g) { escapableG in
      queue.async(execute: escapableF)           // 2
      queue.async(execute: escapableG)     
 
      queue.sync(flags: .barrier) {}             // 3
    }                                            // 4
  }
}
```

æ­¤å‡½æ•°åŒæ—¶åŠ è½½ä¸¤ä¸ªé—­åŒ…ï¼Œç„¶ååœ¨ä¸¤ä¸ªå®Œæˆä¹‹åè¿”å›ã€‚

1. `f` ä¸ `g` è¿›å…¥å‡½æ•°åç”±éé€ƒé€¸çŠ¶æ€ï¼Œåˆ†åˆ«è½¬æ¢ä¸ºé€ƒé€¸é—­åŒ…:`escapableF`å’Œ`escapableG`ã€‚
2. async(execute:) çš„è°ƒç”¨éœ€è¦é€ƒé€¸é—­åŒ…ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢å·²ç»è¿›è¡Œäº†è½¬æ¢ã€‚
3. é€šè¿‡è¿è¡Œ`sync(flags: .barrier)`ï¼Œæ‚¨ç¡®ä¿`async(execute:)`æ–¹æ³•å®Œå…¨å®Œæˆï¼Œç¨åå°†ä¸ä¼šè°ƒç”¨é—­åŒ…ã€‚
4. åœ¨èŒƒå›´å†…ä½¿ç”¨ `escapableF` and `escapableG`.

å¦‚æœä½ å­˜å‚¨ä¸´æ—¶é€ƒç¦»é—­åŒ…(å³çœŸæ­£é€ƒè„±)è¿™å°†æ˜¯ä¸€ä¸ªBugã€‚æœªæ¥ç‰ˆæœ¬çš„æ ‡å‡†åº“å¯ä»¥æ£€æµ‹è¿™ä¸ªé™·é˜±,å¦‚æœä½ è¯•å›¾è°ƒç”¨å®ƒä»¬ã€‚

## Swift Package Manager æ›´æ–°

å•Šï¼ŒæœŸå¾…å·²ä¹…çš„ **Swift Package Manage** çš„æ›´æ–°äº†ï¼

#### å¯ç¼–è¾‘è½¯ä»¶åŒ…ï¼ˆEditable Packagesï¼‰

Swift 3.1å°†`å¯ç¼–è¾‘è½¯ä»¶åŒ…(editable packages)`çš„æ¦‚å¿µæ·»åŠ åˆ°Swiftè½¯ä»¶åŒ…ç®¡ç†å™¨ [[ SE-0082 ]](https://github.com/apple/swift-package-manager/blob/master/Documentation/Usage.md#editable-packages)ã€‚

è¯¥`swift package edit`å‘½ä»¤ä½¿ç”¨ç°æœ‰çš„`Packages`å¹¶å°†å…¶è½¬æ¢ä¸º`editable Packages`ã€‚ä½¿ç”¨`--end-edit`å‘½ä»¤å°† `package manager` è¿˜åŸå› **è§„èŒƒè§£æçš„è½¯ä»¶åŒ…ï¼ˆcanonical resolved packagï¼‰**ã€‚

#### ç‰ˆæœ¬å›ºå®šï¼ˆVersion Pinningï¼‰

Swift 3.1 æ·»åŠ äº†ç‰ˆæœ¬å›ºå®šçš„æ¦‚å¿µ[ SE-0145 ]ã€‚è¯¥ `pin` å‘½ä»¤ å›ºå®šä¸€ä¸ªæˆ–æ‰€æœ‰ä¾èµ–å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼š

```swift
$ swift package pin --all      // å›ºå®šæ‰€æœ‰çš„ä¾èµ–
$ swift package pin Foo        // å›ºå®š Foo åœ¨å½“å‰çš„é—­åŒ…
$ swift package pin Foo --version 1.2.3  // å›ºå®š Foo åœ¨ 1.2.3 ç‰ˆæœ¬

```

ä½¿ç”¨`unpin`å‘½ä»¤æ¢å¤åˆ°ä»¥å‰çš„åŒ…ç‰ˆæœ¬ï¼š

```swift
$ swift package unpin â€”all
$ swift package unpin Foo
```

Package manager å°†æ¯ä¸ªä¾èµ–åº“çš„ç‰ˆæœ¬å›ºå®šä¿¡æ¯å­˜å‚¨åœ¨ `Package.pins` æ–‡ä»¶ä¸­ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™Package manager ä¼šè‡ªåŠ¨åˆ›å»ºã€‚

#### å…¶ä»–

`swift package reset` å‘½ä»¤å°†ä¼šæŠŠ Package é‡ç½®å¹²å‡€ã€‚

`swift test --parallel` å‘½ä»¤ æ‰§è¡Œæµ‹è¯•ã€‚

## å…¶ä»–æ”¹åŠ¨

åœ¨ swift 3.1 ä¸­è¿˜æœ‰ä¸€äº›å°æ”¹åŠ¨

#### å¤šé‡è¿”å›å‡½æ•°
Cå‡½æ•°è¿”å›ä¸¤æ¬¡ï¼Œä¾‹å¦‚`vfork` å’Œ `vfork `å·²ç»ä¸ç”¨äº†ã€‚ä»–ä»¬ä»¥æœ‰è¶£çš„æ–¹å¼æ”¹å˜äº†ç¨‹åºçš„æ§åˆ¶æµç¨‹ã€‚æ‰€ä»¥ Swift ç¤¾åŒº å·²ç»ç¦æ­¢äº†è¯¥è¡Œä¸ºï¼Œä»¥å…å¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚

#### è‡ªåŠ¨é“¾æ¥å¤±æ•ˆï¼ˆDisable Auto-Linkingï¼‰

[Swift Package Manager](https://github.com/apple/swift-package-manager) ç¦ç”¨äº†åœ¨Cè¯­è¨€ [**æ¨¡å—æ˜ å°„ï¼ˆmodule mapsï¼‰**](http://nsomar.com/modular-framework-creating-and-using-them/)ä¸­çš„**è‡ªåŠ¨é“¾æ¥**çš„åŠŸèƒ½ï¼š

```swift
// Swift 3.0
module MyCLib {
    header â€œfoo.h"
    link â€œMyCLib"
    export *
}
 
// Swift 3.1
module MyCLib {
    header â€œfoo.hâ€
    export *
}
```

## ç»“è¯­

Swift 3.1æ”¹å–„äº†Swift 3.0çš„ä¸€äº›åŠŸèƒ½ï¼Œä¸ºå³å°†åˆ°æ¥çš„Swift 4.0çš„å¤§æ”¹åŠ¨åšå‡†å¤‡ã€‚è¿™äº›åŒ…æ‹¬å¯¹æ³›å‹ï¼Œæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ›´ç§‘å­¦çš„`String`ç­‰æ–¹é¢çš„ä½œå‡ºæå¤§çš„æ”¹è¿›ã€‚

å¦‚æœä½ æƒ³äº†è§£æ›´å¤šï¼Œè¯·è½¬åˆ° [Swift standard library diffs](https://developer.apple.com/reference/swift?changes=latest_minor) æˆ–è€…æŸ¥çœ‹å®˜æ–¹çš„çš„[Swift CHANGELOG](https://github.com/apple/swift/blob/master/CHANGELOG.md)ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­é˜…è¯»æ‰€æœ‰æ›´æ”¹çš„ä¿¡æ¯ã€‚æˆ–è€…æ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥äº†è§£ **Swift 4.0** ä¸­çš„å†…å®¹ï¼

## è‘—ä½œæƒå£°æ˜

æœ¬æ–‡è¯‘è‡ª [Whatâ€™s New in Swift 3.1?](https://www.raywenderlich.com/156352/whats-new-in-swift-3-1)

ç”±[@æŸè§(BY)](http://github.com/qiubaiying)è¿›è¡Œç¿»è¯‘,é¦–æ¬¡å‘å¸ƒäº [BY Blog](http://qiubaiying.github.io)ï¼Œè½¬è½½è¯·ä¿ç•™åŸæ–‡é“¾æ¥.