---
layout:     post
title:      Swift 4 æ–°ç‰¹æ€§
subtitle:   å¾ˆé«˜å…´ Swift 4 ä¸å†æ˜¯ä¸€é—¨æ–°è¯­è¨€äº†ğŸ˜…
date:       2017-09-11
author:     BY
header-img: img/post-bg-ios10.jpg
catalog: true
tags:
    - iOS
    - Swift
---


### private æƒé™æ‰©å¤§

åœ¨ Swift 4 ä¸­ï¼Œ`extension` å¯ä»¥è¯»å– `private` å˜é‡äº†ã€‚

Swift 3 ä¸­ï¼Œå¦‚æœå°†ä¸»ä½“å‡½æ•°çš„å˜é‡å®šä¹‰ä¸º `private`ï¼Œåˆ™å…¶ `extension` æ— æ³•è¯»å–æ­¤å˜é‡ï¼Œå¿…é¡»å°†å…¶æ”¹ä¸º `filePrivate` æ‰å¯ä»¥ã€‚

### å•å‘åŒºé—´

å•å‘åŒºé—´æ˜¯ä¸€ä¸ªæ–°çš„ç±»å‹ï¼Œä¸»è¦åˆ†ä¸¤ç§ï¼šç¡®å®šä¸Šé™å’Œç¡®å®šä¸‹é™çš„åŒºé—´ã€‚ç›´æ¥ç”¨å­—é¢é‡å®šä¹‰å¤§æ¦‚å¯ä»¥å†™æˆ `â€¦6`å’Œ `2â€¦`

ä¾‹å¦‚

```swift
let intArr = [0, 1, 2, 3, 4]

let arr1 = intArr[...3] 	// [0, 1, 2, 3]
let arr2 = intArr[3...] 	// [3, 4]
```

### å­—ç¬¦ä¸²æ”¹åŠ¨


#### String æ“ä½œç®€åŒ–äº†

`String` è®¸å¤šè¦é€šè¿‡ `.characters` è¿›è¡Œçš„æ“ä½œï¼Œå¯ä»¥ç›´æ¥ç”¨ String è¿›è¡Œæ“ä½œäº†ã€‚

ä¾‹å¦‚ï¼š

```swift
let greeting = "Hello, ğŸ˜œ!"
// No need to drill down to .characters
let n = greeting.count
let endOfSentence = greeting.index(of: "!")!

```

#### æ–°å¢ Substring ç±»å‹


swift 4 ä¸ºå­—ç¬¦ä¸²ç‰‡æ®µæ–°å¢äº†ä¸€ä¸ªå« `Substring` çš„ç±»å‹ã€‚

å½“ä½ åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²çš„ç‰‡æ®µæ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ª `Substring` å®ä¾‹ã€‚`Substring` ä¸ `String` ç”¨æ³•ç›¸åŒï¼Œ å› ä¸ºå­ä¸²å’ŒåŸå­—ç¬¦ä¸²å…±äº«å†…å­˜ï¼Œæ‰€ä»¥å¯¹å­ä¸²çš„æ“ä½œå¿«é€Ÿè€Œä¸”é«˜æ•ˆã€‚

```swift
let greeting = "Hi there! It's nice to meet you! ğŸ‘‹"
let endOfSentence = greeting.index(of: "!")! 

// äº§ç”Ÿ Substring å®ä¾‹
let firstSentence = greeting[...endOfSentence]
// firstSentence == "Hi there!"

// `Substring` ä¸ `String` ç”¨æ³•ç›¸åŒ
let shoutingSentence = firstSentence.uppercased()
// shoutingSentence == "HI THERE!" 
```

ä½†æ˜¯è¦æ³¨æ„ä¸€ä¸ª `Substring` ä¿ç•™ä»å…¶ç”Ÿæˆçš„å®Œæ•´çš„ `String`å€¼ã€‚ å½“æ‚¨ä¼ é€’ä¸€ä¸ªçœ‹ä¼¼å¾ˆå°çš„ `Substring` æ—¶ï¼Œè¿™å¯èƒ½å¯¼è‡´æ„å¤–çš„é«˜å†…å­˜å¼€é”€ã€‚æ‰€ä»¥ä½¿ç”¨ `Substring`æ—¶ï¼Œæœ€å¥½è½¬åŒ–ä¸º `String`.

```swift
let newString = String(substring)
```


#### æ¢è¡Œå¯ä»¥ä¸ç”¨ `\n`äº†ï¼

Swift 3ï¼Œå­—ç¬¦ä¸²æ¢è¡Œè¦æ’å…¥ `\n`ã€‚
ä¾‹å¦‚ï¼š

![](https://ws4.sinaimg.cn/large/006tNc79gy1fjdam0wvhhj305d0283yf.jpg)

åœ¨ Swift 4 å¯ä»¥è¿™æ ·æ“ä½œ:

![](https://ws2.sinaimg.cn/large/006tNc79gy1fjdas2yri4j303q0260sm.jpg)

ç”¨ä¸¤ä¸ª `â€œâ€â€œ` åŒ…è£¹èµ·æ¥çš„å­—ç¬¦ä¸²ä¼šè‡ªåŠ¨æ·»åŠ  `\n` æ¢è¡Œï¼Œæ›´åŠ ç›´è§‚äº†ã€‚æ³¨æ„ï¼šæ¢è¡Œä¸ç¼©è¿›å‚ç…§çš„æ˜¯ç¬¬äºŒä¸ª `â€œâ€â€œ` å·çš„ä½ç½®ã€‚

å—¯ï¼Œæˆ‘è§‰å¾—OKï¼

#### æ”¯æŒ Unicode 9

Swift 4 æ”¯æŒ Unicode 9ï¼Œ[ä¸ºç°ä»£è¡¨æƒ…ç¬¦å·ä¿®æ­£äº†ä¸€äº›é—®é¢˜](https://oleb.net/blog/2016/12/emoji-4-0/)ã€‚


```swift
let family1 = "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦"
let family2 = "ğŸ‘¨\u{200D}ğŸ‘©\u{200D}ğŸ‘§\u{200D}ğŸ‘¦"
family1 == family2 // â†’ true
```

å±…ç„¶è¿˜æœ‰è¿™ç§æ“ä½œ~

### æ–°å¢ KeyPath æ•°æ®ç±»å‹

KeyPath æ˜¯ Swift 4 æ–°å¢åŠ çš„æ•°æ®ç±»å‹ã€‚

å®šä¹‰ä¸¤ä¸ªç»“æ„ä½“ `Person`ä¸`Book` 

```swift
struct Person {
    var name: String
}

struct Book {
    var title: String
    var authors: [Person]
    var primaryAuthor: Person {
        return authors.first!
    }
}

let abelson = Person(name: "Harold Abelson")
let sussman = Person(name: "Gerald Jay Sussman")
let book = Book(title: "Structure and Interpretation of Computer Programs", authors: [abelson, sussman])
```
```swift
book[keyPath: \Book.title]
book[keyPath: \Book.primaryAuthor.name]
// ç›¸å½“ä¸
book.title
book.primaryAuthor.name
```

è¿™é‡Œ `\Book.title` ä¸ `\Book.primaryAuthor.name` å°±æ˜¯ KeyPath.

KeyPath å¯ä»¥ç”¨ `.appending` æ‹¼æ¥

```swift
let authorKeyPath = \Book.primaryAuthor
let nameKeyPath = authorKeyPath.appending(path: \.name)
// nameKeyPath = \Book.primaryAuthor.name
```

### æ–°å¢  `swapAt()` å‡½æ•°
Swift 4 å¼•å…¥äº†ä¸€ç§åœ¨é›†åˆä¸­äº¤æ¢ä¸¤ä¸ªå…ƒç´ çš„æ–°æ–¹æ³•: `swapAt()`

Swift 3 äº¤æ¢é›†åˆä¸­çš„å…ƒç´ çš„ç”¨ `swap()`

```swift
var numbers = [1,2,3,4,5]
swap(&numbers[0], &numbers[1])
// numbers = [2,1,3,4,5]
```

Swift 4 ä¸­å¯ä»¥ç›´æ¥ç”¨ 

```swift
var numbers = [1,2,3,4,5]
numbers.swapAt(0,1)
// numbers = [2,1,3,4,5]
```



### å…¶ä»–æ”¹åŠ¨

å…¶ä»–æ”¹åŠ¨å¦‚ï¼š**æ–°çš„æ•´æ•°åè®®**ã€**æ³›å‹ä¸‹æ ‡**ã€**NSNumber bridging**ç­‰

å¯ä»¥å‚è€ƒï¼š[whats new in swift4](https://github.com/ole/whats-new-in-swift-4)