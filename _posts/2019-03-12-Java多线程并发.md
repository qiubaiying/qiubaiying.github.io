---
layout: post
title: Javaå¤šçº¿ç¨‹å¹¶å‘
subtitle: ğŸ˜Javaä¸­çš„å¤šçº¿ç¨‹å’Œå¹¶å‘ğŸ˜
date: 2019-03-12
author: åä»”
header-img: img/post-bg-debug.png
catalog: true
tags:
    - Java
---

### Javaå¹¶å‘çŸ¥è¯†åº“

![Javaå¹¶å‘çŸ¥è¯†åº“](http://blog-ipic.yananhuazai.cn/Fm37N-VUDdU0BJ9fn-IufrSO-400)

### Javaçº¿ç¨‹å®ç°/åˆ›å»ºæ–¹å¼

- **ç»§æ‰¿Threadç±»**
  Threadç±»æœ¬è´¨ä¸Šæ˜¯å®ç°äº†Runnableæ¥å£çš„ä¸€ä¸ªç¤ºä¾‹ï¼Œä»£è¡¨ä¸€ä¸ªçº¿ç¨‹çš„å®ä¾‹ã€‚å¯åŠ¨çº¿ç¨‹çš„å”¯ä¸€æ–¹æ³•å°±æ˜¯Threadç±»çš„start()å®ä¾‹æ–¹æ³•ã€‚*start()æ–¹æ³•æ˜¯ä¸€ä¸ªnativeæ–¹æ³•*ï¼Œå®ƒå°†å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œå¹¶æ‰§è¡Œrun()æ–¹æ³•ã€‚

  ```java
  public class MyThread extends Thread {
      @Override
      public void run() {
          System.out.println("MyThread.run()");
      }
  }
  class Test {
      public static void main(String[] args) {
          MyThread myThread = new MyThread();
          myThread.start();
      }
  }
  ```

- **å®ç°Runnableæ¥å£**

  ```java
  public class MyThread implements Runnable {
    @Override
    public void run() {
        System.out.println("MyThread.run()");
    }
  }
  class Test {
    public static void main(String[] args) {
        //å¯åŠ¨MyThreadï¼Œéœ€è¦é¦–å…ˆå®ä¾‹åŒ–ä¸€ä¸ªThreadï¼Œå¹¶ä¼ å…¥è‡ªå·±çš„MyThreadå®ä¾‹
        MyThread myThread = new MyThread();
        Thread thread = new Thread(myThread);
        //äº‹å®ä¸Šï¼Œå½“ä¼ å…¥ä¸€ä¸ªRunnable targetå‚æ•°ç»™Threadåï¼ŒThreadçš„run()æ–¹æ³•å°±ä¼šè°ƒç”¨target.run()
        thread.start();
    }
  }
  ```

- **ExecutorServiceã€Callable<Class>ã€Futureæœ‰è¿”å›å€¼çº¿ç¨‹**

  æœ‰è¿”å›å€¼çš„ä»»åŠ¡å¿…é¡»å®ç°Callableæ¥å£ï¼Œç±»ä¼¼çš„ï¼Œæ— è¿”å›å€¼çš„ä»»åŠ¡å¿…é¡»å®ç°Runnableæ¥å£ã€‚æ‰§è¡ŒCallableä»»åŠ¡åï¼Œå¯ä»¥è·å–ä¸€ä¸ªFutureçš„å¯¹è±¡ï¼Œåœ¨è¯¥å¯¹è±¡ä¸Šè°ƒç”¨getå°±å¯ä»¥è·å–åˆ°Callableä»»åŠ¡è¿”å›çš„Objectäº†ï¼Œå†ç»“åˆçº¿ç¨‹æ± æ¥å£ExecutorServiceå°±å¯ä»¥å®ç°ä¼ è¯´ä¸­çš„**æœ‰è¿”å›ç»“æœçš„å¤šçº¿ç¨‹**äº†ã€‚

  ```java
  public class MyThread {
    public static void main(String[] args) throws ExecutionException, InterruptedException {
        //ä»»åŠ¡æ•°é‡
        int taskSize = 10;
        //åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± 
        ExecutorService pool = Executors.newFixedThreadPool(taskSize);
        //åˆ›å»ºå¤šä¸ªæœ‰è¿”å›å€¼çš„ä»»åŠ¡
        List<Future> list = new ArrayList<>();
        for (int i = 0; i < taskSize; i++) {
            Callable c = new MyCallable(i+"");
            //æ‰§è¡Œä»»åŠ¡å¹¶è·å–Futureå¯¹è±¡
            Future f = pool.submit(c);
            list.add(f);
        }
        //å…³é—­çº¿ç¨‹
        pool.shutdown();
        //è·å–æ‰€æœ‰å¹¶å‘ä»»åŠ¡çš„è¿è¡Œç»“æœ
        for (Future future : list) {
            //ä»Futureå¯¹è±¡ä¸Šè·å–ä»»åŠ¡çš„è¿”å›å€¼ï¼Œå¹¶è¾“å‡ºåˆ°æ§åˆ¶å°
            System.out.println("res:"+ future.get().toString());
        }
    }
  }
  class MyCallable implements Callable {
    private String param;
    MyCallable(String param) {
        this.param = param;
    }
    @Override
    public Object call() {
        System.out.println("æ‰§è¡Œäº†MyCallableçš„call()");
        return param;
    }
  }
  ```

- **åŸºäºçº¿ç¨‹æ± çš„æ–¹å¼**

    çº¿ç¨‹å’Œæ•°æ®åº“è¿æ¥è¿™äº›èµ„æºéƒ½æ˜¯éå¸¸å®è´µçš„èµ„æºã€‚é‚£ä¹ˆæ¯æ¬¡éœ€è¦çš„æ—¶å€™åˆ›å»ºï¼Œä¸éœ€è¦çš„æ—¶å€™é”€æ¯ï¼Œæ˜¯éå¸¸æµªè´¹èµ„æºçš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ç¼“å­˜ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨çº¿ç¨‹æ± ã€‚

      ```java
    public class MyThread {
      public static void main(String[] args) {
          //åˆ›å»ºçº¿ç¨‹æ± 
          ExecutorService threadPool = Executors.newFixedThreadPool(10);
          while (true) {
              threadPool.execute(()->{
                  //æäº¤å¤šä¸ªçº¿ç¨‹ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œ
                  System.out.println(Thread.currentThread().getName() + " is running...");
                  try {
                      Thread.sleep(3000);
                  } catch (InterruptedException e) {
                      e.printStackTrace();
                  }
              });
          }
      }
    }
      ```


### 4ç§çº¿ç¨‹æ± 

â€‹	Javaé‡Œé¢çº¿ç¨‹æ± çš„é¡¶çº§æ¥å£æ˜¯Executorï¼Œä½†æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šè®²Executorå¹¶ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œè€Œåªæ˜¯ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹çš„å·¥å…·ã€‚çœŸæ­£çš„çº¿ç¨‹æ± æ¥å£æ˜¯ExecutorServiceã€‚

![class Executor](http://blog-ipic.yananhuazai.cn/Fssm1QkOh6bDqpYCWHRO6ZS6Kf6G)

- **newCachedThreadPool**
  åˆ›å»ºä¸€ä¸ªå¯æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œä½†æ˜¯åœ¨ä»¥å‰æ„é€ çš„çº¿ç¨‹å¯ç”¨æ—¶å°†é‡ç”¨å®ƒä»¬ã€‚å¯¹äºæ‰§è¡Œå¾ˆå¤šçŸ­æœŸå¼‚æ­¥ä»»åŠ¡çš„ç¨‹åºè€Œè¨€ï¼Œè¿™äº›çº¿ç¨‹æ± é€šå¸¸å¯æé«˜ç¨‹åºæ€§èƒ½ã€‚*è°ƒç”¨executeå°†é‡ç”¨ä»¥å‰æ„é€ çš„çº¿ç¨‹ï¼ˆå¦‚æœçº¿ç¨‹å¯ç”¨ï¼‰ã€‚å¦‚æœç°æœ‰çº¿ç¨‹æ²¡æœ‰å¯ç”¨çš„ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹å¹¶æ·»åŠ åˆ°æ± ä¸­ã€‚ç»ˆæ­¢å¹¶ä»ç¼“å­˜ä¸­ç§»é™¤é‚£äº›å·²æœ‰60ç§’é’Ÿæœªè¢«ä½¿ç”¨çš„çº¿ç¨‹ã€‚*å› æ­¤ï¼Œé•¿æ—¶é—´ä¿æŒç©ºé—²çš„çº¿ç¨‹æ± ä¸ä¼šä½¿ç”¨ä»»ä½•èµ„æºã€‚

- **newFixedThreadPool**

  *åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ï¼Œä»¥å…±äº«çš„æ— ç•Œé˜Ÿåˆ—æ–¹å¼æ¥è¿è¡Œè¿™äº›çº¿ç¨‹ã€‚*åœ¨ä»»æ„ç‚¹ï¼Œåœ¨å¤§å¤šæ•°nThreadsçº¿ç¨‹ä¼šå¤„äºå¤„ç†ä»»åŠ¡çš„æ´»åŠ¨çŠ¶æ€ã€‚å¦‚æœåœ¨æ‰€æœ‰çº¿ç¨‹å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶æäº¤é™„åŠ ä»»åŠ¡ï¼Œåˆ™åœ¨æœ‰å¯ç”¨çº¿ç¨‹ä¹‹å‰ï¼Œé™„åŠ ä»»åŠ¡å°†åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚å¦‚æœåœ¨å…³é—­å‰çš„æ‰§è¡ŒæœŸé—´ç”±äºå¤±è´¥è€Œå¯¼è‡´ä»»ä½•çº¿ç¨‹ç»ˆæ­¢ï¼Œé‚£ä¹ˆä¸€ä¸ªæ–°çº¿ç¨‹å°†ä»£æ›¿å®ƒæ‰§è¡Œåç»­çš„ä»»åŠ¡ï¼ˆå¦‚æœéœ€è¦ï¼‰ã€‚åœ¨æŸä¸ªçº¿ç¨‹è¢«æ˜¾å¼åœ°å…³é—­ä¹‹å‰ï¼Œæ± ä¸­çš„çº¿ç¨‹å°†ä¸€ç›´å­˜åœ¨ã€‚

- **newScheduledThreadPool**

  åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå®ƒå¯å®‰æ’åœ¨ç»™å®šå»¶è¿Ÿåè¿è¡Œå‘½ä»¤åè€…å®šæœŸåœ°æ‰§è¡Œã€‚
  ```java
  public class MyThread {
    public static void main(String[] args) {
        System.out.println("ç¨‹åºè·‘èµ·æ¥äº†");
        ScheduledExecutorService scheduledThreadPool = Executors.newScheduledThreadPool(3);
        scheduledThreadPool.schedule(() -> {
            System.out.println("å»¶è¿Ÿä¸‰ç§’");
        }, 3, TimeUnit.SECONDS);
        scheduledThreadPool.scheduleAtFixedRate(() -> {
            System.out.println("å»¶è¿Ÿä¸€ç§’åæ¯ä¸‰ç§’æ‰§è¡Œä¸€æ¬¡");
        }, 1, 3, TimeUnit.SECONDS);
    }
  }
  ```

- **newSingleThreadExecutor**

  Executors.newSingleThreadExecutor()è¿”å›ä¸€ä¸ªçº¿ç¨‹æ± ï¼ˆè¿™ä¸ªçº¿ç¨‹æ± åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼‰ï¼Œ*è¿™ä¸ªçº¿ç¨‹æ± å¯ä»¥åœ¨çº¿ç¨‹æ­»åï¼ˆæˆ–å‘ç”Ÿå¼‚å¸¸æ—¶ï¼‰é‡æ–°å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥ä»£æ›¿åŸæœ‰çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œä¸‹å»*ï¼

### çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼ˆçŠ¶æ€ï¼‰
å½“çº¿ç¨‹è¢«åˆ›å»ºå¹¶å¯åŠ¨ä»¥åï¼Œå®ƒæ—¢ä¸æ˜¯ä¸€å¯åŠ¨å°±è¿›å…¥äº†æ‰§è¡ŒçŠ¶æ€ï¼Œä¹Ÿä¸æ˜¯ä¸€ç›´å¤„äºæ‰§è¡ŒçŠ¶æ€ã€‚åœ¨çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå®ƒè¦ç»è¿‡æ–°å»ºï¼ˆNewï¼‰ã€å°±ç»ªï¼ˆRunnableï¼‰ã€è¿è¡Œï¼ˆRunningï¼‰ã€é˜»å¡ï¼ˆBlockedï¼‰å’Œæ­»äº¡ï¼ˆDeadï¼‰5ç§çŠ¶æ€ã€‚å°¤å…¶æ˜¯å½“çº¿ç¨‹å¯åŠ¨ä»¥åï¼Œå®ƒä¸å¯èƒ½ä¸€ç›´â€œéœ¸å â€ç€CPUç‹¬è‡ªè¿è¡Œï¼Œæ‰€ä»¥CPUéœ€è¦åœ¨å¤šçº¿ç¨‹ä¹‹é—´åˆ‡æ¢ï¼Œäºæ˜¯çº¿ç¨‹çŠ¶æ€ä¹Ÿä¼šå¤šæ¬¡åœ¨è¿è¡Œã€é˜»å¡ä¹‹é—´åˆ‡æ¢ã€‚

- **æ–°å»ºçŠ¶æ€(New)**

  å½“ç¨‹åº*ä½¿ç”¨newå…³é”®å­—åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹ä¹‹å*ï¼Œè¯¥çº¿ç¨‹å°±å¤„äºæ–°å»ºçŠ¶æ€ï¼Œæ­¤æ—¶ä»…ç”±JVMä¸ºå…¶åˆ†é…å†…å­˜ï¼Œå¹¶åˆå§‹åŒ–å…¶æˆå‘˜å˜é‡çš„å€¼ã€‚

- **å°±ç»ªçŠ¶æ€(Runnable)**

  å½“çº¿ç¨‹å¯¹è±¡*è°ƒç”¨äº†start()æ–¹æ³•ä¹‹å*ï¼Œè¯¥çº¿ç¨‹å¤„äºå°±ç»ªçŠ¶æ€ã€‚Javaè™šæ‹Ÿæœºä¼šä¸ºå…¶åˆ›å»ºæ–¹æ³•è°ƒç”¨æ ˆå’Œç¨‹åºè®¡æ•°å™¨ï¼Œç­‰å¾…è°ƒåº¦è¿è¡Œã€‚

- **è¿è¡ŒçŠ¶æ€(Running)**

  å¦‚æœå¤„äº*å°±ç»ªçŠ¶æ€çš„çº¿ç¨‹è·å¾—äº†CPUï¼Œå¼€å§‹æ‰§è¡Œrun()æ–¹æ³•çš„çº¿ç¨‹æ‰§è¡Œä½“*ï¼Œåˆ™è¯¥çº¿ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€ã€‚

- **é˜»å¡çŠ¶æ€(Blocked)**

  é˜»å¡çŠ¶æ€æ˜¯æŒ‡çº¿ç¨‹å› ä¸ºæŸç§åŸå› æ”¾å¼ƒäº†cpuä½¿ç”¨æƒï¼Œä¹Ÿå³è®©å‡ºäº†cpu timesliceï¼Œæš‚æ—¶åœæ­¢è¿è¡Œã€‚ç›´åˆ°çº¿ç¨‹è¿›å…¥å¯è¿è¡Œ(runnable)çŠ¶æ€ï¼Œæ‰æœ‰æœºä¼šå†æ¬¡è·å¾—cput timesliceè½¬åˆ°è¿è¡Œ(running)çŠ¶æ€ã€‚é˜»å¡çš„æƒ…å†µåˆ†ä¸ºä¸‰ç§ï¼š

  - ç­‰å¾…é˜»å¡ï¼ˆo.wait->ç­‰å¾…é˜Ÿåˆ—ï¼‰ï¼š
    - è¿è¡Œï¼ˆrunningï¼‰çš„çº¿ç¨‹æ‰§è¡Œo.wait()æ–¹æ³•ï¼ŒJVMä¼šæŠŠè¯¥çº¿ç¨‹æ”¾å…¥ç­‰å¾…é˜Ÿåˆ—(waiting queue)ä¸­ã€‚
  - åŒæ­¥é˜»å¡ï¼ˆlock->é”æ± ï¼‰ï¼š
    - è¿è¡Œï¼ˆrunningï¼‰çš„çº¿ç¨‹åœ¨è·å–å¯¹è±¡çš„åŒæ­¥é”æ—¶ï¼Œè‹¥è¯¥*åŒæ­¥é”è¢«åˆ«çš„çº¿ç¨‹å ç”¨*ï¼Œåˆ™JVMä¼šæŠŠçº¿ç¨‹æ”¾å…¥é”æ± ï¼ˆlock poolï¼‰ä¸­ã€‚
  - å…¶ä»–é˜»å¡ï¼ˆsleep/joinï¼‰ï¼š
    - è¿è¡Œï¼ˆrunningï¼‰çš„çº¿ç¨‹æ‰§è¡ŒThread.sleep(long ms)æˆ–t.join()æ–¹æ³•ï¼Œæˆ–è€…å‘å‡ºI/Oè¯·æ±‚æ—¶ï¼ŒJVMä¼šæŠŠè¯¥çº¿ç¨‹ç½®ä½é˜»å¡çŠ¶æ€ã€‚å½“sleep()çŠ¶æ€è¶…æ—¶ã€join()ç­‰å¾…çº¿ç¨‹ç»ˆæ­¢æˆ–è€…è¶…æ—¶ã€æˆ–è€…I/Oå¤„ç†å®Œæ¯•æ—¶ï¼Œçº¿ç¨‹é‡æ–°è½¬å…¥å¯è¿è¡ŒçŠ¶æ€ï¼ˆrunnableï¼‰çŠ¶æ€ã€‚

- **çº¿ç¨‹æ­»äº¡ï¼ˆDeadï¼‰**

  çº¿ç¨‹ä¼šä»¥ä¸‹é¢ä¸‰ç§æ–¹å¼ç»“æŸï¼Œç»“æŸåå°±æ˜¯æ­»äº¡çŠ¶æ€ã€‚

  1. æ­£å¸¸ç»“æŸï¼šrun()æˆ–call()æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œçº¿ç¨‹æ­£å¸¸ç»“æŸã€‚
  2. å¼‚å¸¸ç»“æŸï¼šçº¿ç¨‹æŠ›å‡ºä¸€ä¸ªæœªæ•è·çš„Exceptionæˆ–Errorã€‚
  3. è°ƒç”¨stopï¼šç›´æ¥è°ƒç”¨è¯¥çº¿ç¨‹çš„stop()æ–¹æ³•æ¥ç»“æŸè¯¥çº¿ç¨‹--*è¯¥æ–¹æ³•é€šå¸¸å®¹æ˜“å¯¼è‡´æ­»é”*ï¼Œä¸æ¨èä½¿ç”¨ã€‚

	![çº¿ç¨‹æ‰§è¡Œæµç¨‹](http://blog-ipic.yananhuazai.cn/FlVL-sTkNSAp4W6MYXLva_Gfsmct)
  
  
### ç»ˆæ­¢çº¿ç¨‹4ç§æ–¹å¼

- **æ­£å¸¸è¿è¡Œç»“æŸ**

  - ç¨‹åºè¿è¡Œç»“æŸï¼Œçº¿ç¨‹è‡ªåŠ¨ç»“æŸã€‚

- ä½¿ç”¨é€€å‡ºæ ‡å¿—é€€å‡ºçº¿ç¨‹

  ä¸€èˆ¬run()æ–¹æ³•æ‰§è¡Œå®Œï¼Œçº¿ç¨‹å°±ä¼šæ­£å¸¸ç»“æŸï¼Œç„¶è€Œï¼Œå¸¸å¸¸æœ‰äº›çº¿ç¨‹æ˜¯ä¼ºæœçº¿ç¨‹ã€‚å®ƒä»¬éœ€è¦é•¿æ—¶é—´çš„è¿è¡Œï¼Œåªæœ‰åœ¨å¤–éƒ¨æŸäº›æ¡ä»¶æ»¡è¶³çš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½å…³é—­è¿™äº›çº¿ç¨‹ã€‚ä½¿ç”¨ä¸€ä¸ªå˜é‡æ¥æ§åˆ¶å¾ªç¯ï¼Œä¾‹å¦‚ï¼šæœ€ç›´æ¥çš„æ–¹æ³•å°±æ˜¯è®¾ä¸€ä¸ªbooleanç±»å‹çš„æ ‡å¿—ï¼Œå¹¶é€šè¿‡è®¾ç½®è¿™ä¸ªæ ‡å¿—ä¸ºtrueæˆ–falseæ¥æ§åˆ¶whileå¾ªç¯æ˜¯å¦é€€å‡ºï¼Œä»£ç ç¤ºä¾‹ï¼š

  ```java
  public class ThreadSafe extends Thread {
      public volatile boolean exit = false;
      public void run() {
          while(!exit) {
              //do something
          }
      }
  }
  ```

  å®šä¹‰äº†ä¸€ä¸ªé€€å‡ºæ ‡å¿—exitï¼Œå½“exitä¸ºtrueæ—¶ï¼Œwhileå¾ªç¯é€€å‡ºï¼Œexitçš„é»˜è®¤å€¼ä¸ºfalseã€‚åœ¨å®šä¹‰exitæ—¶ï¼Œ*ä½¿ç”¨äº†ä¸€ä¸ªJavaå…³é”®å­—volatileï¼Œè¿™ä¸ªå…³é”®å­—çš„ç›®çš„æ˜¯ä½¿exitåŒæ­¥*ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨åŒä¸€æ—¶åˆ»åªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹æ¥ä¿®æ”¹exitçš„å€¼ã€‚

- Interruptæ–¹æ³•ç»“æŸçº¿ç¨‹

  ä½¿ç”¨interrupt()æ–¹æ³•æ¥ä¸­æ–­çº¿ç¨‹æœ‰ä¸¤ç§æƒ…å†µï¼š

  1. çº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€ï¼šä½¿ç”¨äº†sleepï¼ŒåŒæ­¥é”çš„waitï¼Œsocketä¸­çš„receiver/acceptç­‰æ–¹æ³•æ—¶ï¼Œä¼šä½¿çº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€ã€‚å½“è°ƒç”¨çº¿ç¨‹interrupt()æ–¹æ³•æ—¶ï¼Œä¼šæŠ›å‡ºInterruptedExceptionå¼‚å¸¸ã€‚é˜»å¡ä¸­çš„é‚£ä¸ªæ–¹æ³•æŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ï¼Œé€šè¿‡ä»£ç æ•è·è¯¥å¼‚å¸¸ï¼Œç„¶åbreakè·³å‡ºå¾ªç¯çŠ¶æ€ï¼Œä»è€Œè®©æˆ‘ä»¬æœ‰æœºä¼šç»“æŸè¿™ä¸ªçº¿ç¨‹çš„æ‰§è¡Œã€‚*é€šå¸¸å¾ˆå¤šäººè®¤ä¸ºåªè¦è°ƒç”¨interruptæ–¹æ³•çº¿ç¨‹å°±ä¼šç»“æŸï¼Œï¼Œå®é™…ä¸Šæ˜¯é”™çš„ï¼Œä¸€å®šè¦å…ˆæ•è·interruptedExceptionå¼‚å¸¸ä¹‹åé€šè¿‡breakæ¥è·³å‡ºå¾ªç¯ï¼Œæ‰èƒ½æ­£å¸¸ç»“æŸrunæ–¹æ³•*ã€‚

  2. çº¿ç¨‹æœªå¤„äºé˜»å¡çŠ¶æ€ï¼šä½¿ç”¨isInterrupted()åˆ¤æ–­çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—æ¥é€€å‡ºå¾ªç¯ã€‚å½“ä½¿ç”¨interrupt()æ–¹æ³•æ—¶ï¼Œä¸­æ–­æ ‡å¿—å°±ä¼šç½®ä½trueï¼Œå’Œä½¿ç”¨è‡ªå®šä¹‰çš„æ ‡å¿—æ¥æ§åˆ¶å¾ªç¯æ—¶ä¸€æ ·çš„é“ç†ã€‚

     ```java
     public class ThreadSafe extends Thread {
         @Override
         public void run() {
             while (!isInterrupted()) { //éé˜»å¡è¿‡ç¨‹ä¸­é€šè¿‡åˆ¤æ–­ä¸­æ–­æ ‡å¿—æ¥é€€å‡º
                 try {
                     Thread.sleep(5 * 1000);
                 } catch (InterruptedException e) {
                     e.printStackTrace();
                     break; //æ•è·åˆ°å¼‚å¸¸ä¹‹å,æ‰§è¡Œbreakè·³å‡ºå¾ªç¯
                 }
             }
         }
     }
     ```

- **stopæ–¹æ³•ç»ˆæ­¢çº¿ç¨‹ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰**

  ç¨‹åºä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨thread.stop()æ¥å¼ºè¡Œç»ˆæ­¢çº¿ç¨‹ï¼Œä½†æ˜¯stopæ–¹æ³•æ˜¯å¾ˆå±é™©çš„ï¼Œå°±åƒçªç„¶å…³é—­è®¡ç®—æœºç”µæºï¼Œè€Œä¸æ˜¯æŒ‰æ­£å¸¸ç¨‹åºå…³æœºä¸€æ ·ï¼Œå¯èƒ½ä¼šäº§ç”Ÿä¸å¯é¢„æ–™çš„ç»“æœï¼Œä¸å®‰å…¨ä¸»è¦æ˜¯ï¼šthread.stop()è°ƒç”¨ä¹‹åï¼Œåˆ›å»ºå­çº¿ç¨‹çš„çº¿ç¨‹å°±ä¼šæŠ›å‡ºThreadDeathçš„é”™è¯¯ï¼Œå¹¶ä¼šé‡Šæ”¾å­çº¿ç¨‹æ‰€æŒæœ‰çš„æ‰€æœ‰é”ã€‚ä¸€èˆ¬ä»»ä½•è¿›è¡ŒåŠ é”çš„ä»£ç å—ï¼Œéƒ½æ˜¯ä¸ºäº†ä¿æŠ¤æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¦‚æœåœ¨*è°ƒç”¨thread.stop()åå¯¼è‡´äº†è¯¥çº¿ç¨‹æ‰€æŒæœ‰çš„æ‰€æœ‰é”çš„çªç„¶é‡Šæ”¾(ä¸å¯æ§åˆ¶)*ï¼Œé‚£ä¹ˆè¢«ä¿æŠ¤æ•°æ®å°±æœ‰å¯èƒ½å‘ˆç°ä¸ä¸€è‡´æ€§ï¼Œå…¶ä»–çº¿ç¨‹åœ¨ä½¿ç”¨è¿™äº›è¢«ç ´åçš„æ•°æ®æ—¶ï¼Œæœ‰å¯èƒ½å¯¼è‡´ä¸€äº›å¾ˆå¥‡æ€ªçš„åº”ç”¨ç¨‹åºé”™è¯¯ã€‚å› æ­¤ï¼Œå¹¶ä¸æ¨èè¯•ç”¨ stopæ–¹æ³•æ¥ç»ˆæ­¢çº¿ç¨‹ã€‚

### sleepå’ŒwaitåŒºåˆ«

> åœ¨Javaä¸­æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸¤ä¸ªæ± ï¼šé”æ± ï¼ˆmonitorï¼‰å’Œç­‰å¾…æ± 
>
> é”æ± :å‡è®¾çº¿ç¨‹Aå·²ç»æ‹¥æœ‰äº†æŸä¸ªå¯¹è±¡(æ³¨æ„:ä¸æ˜¯ç±»)çš„é”ï¼Œè€Œå…¶å®ƒçš„çº¿ç¨‹æƒ³è¦è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„æŸä¸ªsynchronizedæ–¹æ³•(æˆ–è€…synchronizedå—)ï¼Œç”±äºè¿™äº›çº¿ç¨‹åœ¨è¿›å…¥å¯¹è±¡çš„synchronizedæ–¹æ³•ä¹‹å‰å¿…é¡»å…ˆè·å¾—è¯¥å¯¹è±¡çš„é”çš„æ‹¥æœ‰æƒï¼Œä½†æ˜¯è¯¥å¯¹è±¡çš„é”ç›®å‰æ­£è¢«çº¿ç¨‹Aæ‹¥æœ‰ï¼Œæ‰€ä»¥è¿™äº›çº¿ç¨‹å°±è¿›å…¥äº†è¯¥å¯¹è±¡çš„é”æ± ä¸­ã€‚
>
> ç­‰å¾…æ± :å‡è®¾ä¸€ä¸ªçº¿ç¨‹Aè°ƒç”¨äº†æŸä¸ªå¯¹è±¡çš„wait()æ–¹æ³•ï¼Œçº¿ç¨‹Aå°±ä¼šé‡Šæ”¾è¯¥å¯¹è±¡çš„é”(å› ä¸ºwait()æ–¹æ³•å¿…é¡»å‡ºç°åœ¨synchronizedä¸­ï¼Œè¿™æ ·è‡ªç„¶åœ¨æ‰§è¡Œwait()æ–¹æ³•ä¹‹å‰çº¿ç¨‹Aå°±å·²ç»æ‹¥æœ‰äº†è¯¥å¯¹è±¡çš„é”)ï¼ŒåŒæ—¶çº¿ç¨‹Aå°±è¿›å…¥åˆ°äº†è¯¥å¯¹è±¡çš„ç­‰å¾…æ± ä¸­ã€‚å¦‚æœå¦å¤–çš„ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº†ç›¸åŒå¯¹è±¡çš„notifyAll()æ–¹æ³•ï¼Œé‚£ä¹ˆå¤„äºè¯¥å¯¹è±¡çš„ç­‰å¾…æ± ä¸­çš„çº¿ç¨‹å°±ä¼šå…¨éƒ¨è¿›å…¥è¯¥å¯¹è±¡çš„é”æ± ä¸­ï¼Œå‡†å¤‡äº‰å¤ºé”çš„æ‹¥æœ‰æƒã€‚å¦‚æœå¦å¤–çš„ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº†ç›¸åŒå¯¹è±¡çš„notify()æ–¹æ³•ï¼Œé‚£ä¹ˆä»…ä»…æœ‰ä¸€ä¸ªå¤„äºè¯¥å¯¹è±¡çš„ç­‰å¾…æ± ä¸­çš„çº¿ç¨‹(éšæœº)ä¼šè¿›å…¥è¯¥å¯¹è±¡çš„é”æ± .

1. å¯¹äºsleep()æ–¹æ³•ï¼Œæˆ‘ä»¬é¦–å…ˆè¦çŸ¥é“è¯¥æ–¹æ³•æ˜¯å±äºThreadç±»ä¸­çš„ã€‚è€Œwait()æ–¹æ³•ï¼Œåˆ™æ˜¯å±äºObjectç±»ä¸­çš„ã€‚
2. sleep()æ–¹æ³•å¯¼è‡´äº†ç¨‹åºæš‚åœæ‰§è¡ŒæŒ‡å®šçš„æ—¶é—´ï¼Œè®©å‡ºcpuç»™å…¶ä»–çº¿ç¨‹ï¼Œä½†æ˜¯ä»–çš„ç›‘æ§çŠ¶æ€ä¾ç„¶ä¿æŒç€ï¼Œå½“æŒ‡å®šçš„æ—¶é—´åˆ°äº†åˆä¼šè‡ªåŠ¨æ¢å¤è¿è¡ŒçŠ¶æ€ã€‚
3. åœ¨è°ƒç”¨sleep()æ–¹æ³•çš„è¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ã€‚
4. è€Œè°ƒç”¨wait()æ–¹æ³•çš„æ—¶å€™ï¼Œçº¿ç¨‹ä¼šæ”¾å¼ƒå¯¹è±¡é”ï¼Œè¿›å…¥æ­¤å¯¹è±¡çš„ç­‰å¾…æ± ï¼Œåªæœ‰é’ˆå¯¹æ­¤å¯¹è±¡è°ƒç”¨notify()æ–¹æ³•æˆ–notifyAll()åæœ¬çº¿ç¨‹æ‰è¿›å…¥å¯¹è±¡é”æ± å‡†å¤‡è·å–å¯¹è±¡é”è¿›å…¥è¿è¡ŒçŠ¶æ€ã€‚

```java
class WaitThread implements Runnable {
    @Override
    public void run() {
        synchronized (D.class) {
            System.out.println(Thread.currentThread().getName() + " into wait");
            try {
                D.class.wait(); //ä½¿è¯¥çº¿ç¨‹è¿›å…¥è¯¥å¯¹è±¡çš„é”æ± ï¼Œå¹¶é‡Šæ”¾è¯¥å¯¹è±¡çš„é”
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            System.out.println(Thread.currentThread().getName()+" wait over");
        }
    }
}
class NotifyThread implements Runnable {
    @Override
    public void run() {
        synchronized (D.class) {
            System.out.println(Thread.currentThread().getName() + " into notify");
            D.class.notify(); //éšæœºä½¿è¯¥å¯¹è±¡çš„ç­‰å¾…æ± ä¸­çš„æŸä¸€ä¸ªçº¿ç¨‹è¿›å…¥é”æ± 
//            D.class.notifyAll(); //ä½¿è¯¥å¯¹è±¡çš„ç­‰å¾…æ± 
            System.out.println(Thread.currentThread().getName() + " notify over");
        }
    }
}
public class D {
    public static void main(String[] args) throws InterruptedException {
//        new Thread(new WaitThread()).start();
//        new Thread(new WaitThread()).start();
//        new Thread(new WaitThread()).start();
//        new Thread(new WaitThread()).start();
//        Thread.sleep(2000);
//        new Thread(new NotifyThread()).start();
//        new Thread(new NotifyThread()).start();
//        new Thread(new NotifyThread()).start();
//        new Thread(new NotifyThread()).start();
//        new Thread(new NotifyThread()).start();
        new Thread(new NotifyThread()).start();
    }
}
```

### startä¸runåŒºåˆ«

1. start()æ–¹æ³•æ¥å¯åŠ¨çº¿ç¨‹ï¼ŒçœŸæ­£å®ç°äº†å¤šçº¿ç¨‹è¿è¡Œã€‚è¿™æ—¶æ— éœ€ç­‰å¾…runæ–¹æ³•ä½“ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå¯ä»¥ç›´æ¥ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚
2. å¯ä»¥è°ƒç”¨Threadç±»çš„start()æ–¹æ³•æ¥å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™æ—¶æ­¤çº¿ç¨‹æ˜¯å¤„äºå°±ç»ªçŠ¶æ€ï¼Œå¹¶æ²¡æœ‰è¿è¡Œã€‚
3. æ–¹æ³•run()ç§°ä¸ºçº¿ç¨‹ä½“ï¼Œå®ƒåŒ…å«äº†è¦æ‰§è¡Œçš„è¿™ä¸ªçº¿ç¨‹çš„å†…å®¹ï¼Œçº¿ç¨‹å°±è¿›å…¥äº†è¿è¡ŒçŠ¶æ€ï¼Œå¼€å§‹è¿è¡Œrunå‡½æ•°å½“ä¸­çš„ä»£ç ã€‚Runæ–¹æ³•è¿è¡Œç»“æŸï¼Œæ­¤çº¿ç¨‹ç»ˆæ­¢ã€‚ç„¶åCPUå†è°ƒåº¦å…¶ä»–çº¿ç¨‹ã€‚

### Javaåå°çº¿ç¨‹

1. å®šä¹‰ï¼šå®ˆæŠ¤çº¿ç¨‹--ä¹Ÿç§°â€æœåŠ¡çº¿ç¨‹â€œï¼Œå®ƒæ˜¯åå°çº¿ç¨‹ï¼Œå®ƒæœ‰ä¸€ä¸ªç‰¹æ€§ï¼Œå³ä¸ºç”¨æˆ·çº¿ç¨‹æä¾›å…¬å…±æœåŠ¡ï¼Œåœ¨æ²¡æœ‰ç”¨æˆ·çº¿ç¨‹å¯æœåŠ¡æ—¶ä¼šè‡ªåŠ¨ç¦»å¼€ã€‚
2. ä¼˜å…ˆçº§ï¼šå®ˆæŠ¤çº¿ç¨‹çš„ä¼˜å…ˆçº§æ¯”è¾ƒä½ï¼Œç”¨äºä¸ºç³»ç»Ÿä¸­çš„å…¶å®ƒå¯¹è±¡å’Œçº¿ç¨‹æä¾›æœåŠ¡ã€‚
3. è®¾ç½®ï¼šé€šè¿‡setDeamon(true)æ¥è®¾ç½®çº¿ç¨‹ä¸ºâ€œå®ˆæŠ¤çº¿ç¨‹â€ï¼›å°†ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹çš„æ–¹å¼æ˜¯åœ¨çº¿ç¨‹å¯¹è±¡åˆ›å»ºä¹‹å‰ç”¨çº¿ç¨‹å¯¹è±¡çš„setDeamonæ–¹æ³•ã€‚
4. åœ¨Deamonçº¿ç¨‹ä¸­äº§ç”Ÿçš„æ–°çº¿ç¨‹ä¹Ÿæ˜¯Deamonçš„ã€‚
5. çº¿ç¨‹åˆ™æ˜¯JVMçº§åˆ«çš„ï¼Œä»¥Tomcatä¸ºä¾‹ï¼Œå¦‚æœä½ åœ¨Webåº”ç”¨ä¸­å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå¹¶ä¸ä¼šå’ŒWebåº”ç”¨ç¨‹åºä¿æŒåŒæ­¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿ä½ åœæ­¢äº†Webåº”ç”¨ï¼Œè¿™ä¸ªçº¿ç¨‹ä¾æ—§æ˜¯æ´»è·ƒçš„ã€‚
6. exampleï¼šåƒåœ¾å›æ”¶çº¿ç¨‹å°±æ˜¯ä¸€ä¸ªç»å…¸çš„å®ˆæŠ¤çº¿ç¨‹ï¼Œå½“æˆ‘ä»¬çš„ç¨‹åºä¸­ä¸å†æœ‰ä»»ä½•è¿è¡Œçš„Threadï¼Œç¨‹åºå°±ä¸ä¼šå†äº§ç”Ÿåƒåœ¾ï¼Œåƒåœ¾å›æ”¶å™¨ä¹Ÿå°±æ— äº‹å¯åšï¼Œ*æ‰€ä»¥å½“åƒåœ¾å›æ”¶çº¿ç¨‹æ˜¯JVMä¸Šä»…å‰©çš„çº¿ç¨‹æ—¶ï¼Œåƒåœ¾å›æ”¶çº¿ç¨‹ä¼šè‡ªåŠ¨ç¦»å¼€*ã€‚å®ƒå§‹ç»ˆåœ¨ä½çº§åˆ«çš„çŠ¶æ€ä¸­è¿è¡Œï¼Œç”¨äºå®æ—¶ç›‘æ§å’Œç®¡ç†ç³»ç»Ÿä¸­çš„å¯å›æ”¶èµ„æºã€‚
7. ç”Ÿå‘½å‘¨æœŸï¼šå®ˆæŠ¤è¿›ç¨‹ï¼ˆDeamonï¼‰æ˜¯è¿è¡Œåœ¨åå°çš„ä¸€ç§ç‰¹æ®Šè¿›ç¨‹ã€‚å®ƒç‹¬ç«‹äºæ§åˆ¶ç»ˆç«¯å¹¶ä¸”å‘¨æœŸæ€§åœ°æ‰§è¡ŒæŸç§ä»»åŠ¡æˆ–ç­‰å¾…å¤„ç†æŸäº›å‘ç”Ÿçš„äº‹ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´å®ˆæŠ¤çº¿ç¨‹ä¸ä¾èµ–äºç»ˆç«¯ï¼Œä½†æ˜¯ä¾èµ–äºç³»ç»Ÿï¼Œä¸ç³»ç»Ÿâ€œåŒç”Ÿå…±æ­»â€œã€‚å½“JVMä¸­æ‰€æœ‰çš„çº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹çš„æ—¶å€™ï¼ŒJVMå°±å¯ä»¥é€€å‡ºäº†ï¼›å¦‚æœè¿˜æœ‰ä¸€ä¸ªæˆ–ä»¥ä¸Šçš„éå®ˆæŠ¤çº¿ç¨‹åˆ™JVMä¸ä¼šé€€å‡ºã€‚