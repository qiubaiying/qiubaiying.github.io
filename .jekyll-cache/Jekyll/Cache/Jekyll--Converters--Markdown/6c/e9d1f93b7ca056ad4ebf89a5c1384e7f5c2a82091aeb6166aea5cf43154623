I"0‚<h1 id="å‰è¨€">å‰è¨€</h1>

<blockquote>
  <p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« <a href="http://www.jianshu.com/p/a36bfc976b8e">ã€ŠObjective-C Runtimeè¯¦è§£ã€‹</a>ä¸­æˆ‘ä»¬æ¢è®¨äº†Runtimeçš„åŸºæœ¬åŸç†ï¼Œè¿™ç¯‡æ–‡ç« æˆ‘ä»¬å°†æ€»ç»“ä¸€ä¸‹Runtimeçš„ä¸€äº›åŸºæœ¬ä½¿ç”¨</p>
</blockquote>

<h1 id="ä½¿ç”¨æ–¹æ³•">ä½¿ç”¨æ–¹æ³•</h1>

<ul>
  <li>æŸ¥è¯¢æ–¹æ³•</li>
  <li>ç»™åˆ†ç±»æ·»åŠ å±æ€§</li>
  <li>æ›´æ¢ä»£ç çš„å®ç°æ–¹æ³•</li>
  <li>åŠ¨æ€æ·»åŠ æ–¹æ³•</li>
  <li>å­—å…¸è½¬å±æ€§</li>
</ul>

<h1 id="å‡†å¤‡">å‡†å¤‡</h1>

<p>å…ˆåˆ›å»ºä¸¤ä¸ªç±»</p>

<p><code class="language-plaintext highlighter-rouge">ClassA.h</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#import &lt;Foundation/Foundation.h&gt;

@interface ClassA : NSObject {
    // å…¬æœ‰å˜é‡
    NSString *_publicVar1;
    NSString *_publicVar2;

}
// å…¬æœ‰å±æ€§
@property(nonatomic,copy) NSString *publicProperty1;
@property(nonatomic,copy) NSString *publicProperty2;

/* å…¬æœ‰æ–¹æ³• */
-(void)methodAOfClassAWithArg:(NSString *)arg;

@end

</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">ClassA.m</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#import "ClassA.h"

@interface ClassA()
// ç§æœ‰å±æ€§
@property(nonatomic,copy) NSString *privateProperty1;
@property(nonatomic,copy) NSString *privateProperty2;

@end

@implementation ClassA {
    // ç§æœ‰å˜é‡
    NSString *_privateVar1;
    NSString *_privateVar2;
}

/* å…¬æœ‰æ–¹æ³• */
-(void)methodAOfClassAWithArg:(NSString *)arg {
    NSLog(@" methodAOfClassA arg = %@", arg);
}

/* ç§æœ‰æ–¹æ³• */
-(void)MethodBOfClassAWithArg:(NSString *)arg {
    NSLog(@" methodBOfClassA arg = %@", arg);
}
@end
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">ClassB.h</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#import &lt;Foundation/Foundation.h&gt;

@interface ClassB : NSObject

/* å…¬æœ‰æ–¹æ³• */
-(void)methodAOfClassBWithArg:(NSString *)arg;

@end
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">ClassB.m</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#import "ClassB.h"

@implementation ClassB
- (void)methodAOfClassBWithArg:(NSString *)arg {
    NSLog(@" methodAOfClassB arg = %@", arg);
}

-(void)methodBOfClassBWithArg:(NSString *)arg {
    NSLog(@" methodBOfClassB arg = %@", arg);
}

@end
</code></pre></div></div>

<h2 id="æŸ¥è¯¢æ–¹æ³•">æŸ¥è¯¢æ–¹æ³•</h2>
<hr />

<p>åœ¨Objective-C Runtimeä¸‹æ²¡æœ‰çœŸæ­£æ„ä¹‰ä¸Šçš„ç§æœ‰å˜é‡å’Œæ–¹æ³•ï¼Œå› ä¸ºè¿™äº›ç§æœ‰å˜é‡å’Œæ–¹æ³•éƒ½å¯ä»¥é€šè¿‡Runtimeæ–¹æ³•è·å–ï¼Œè¿™å½“ç„¶åŒ…æ‹¬ç³»ç»Ÿçš„ç§æœ‰APIã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä¸€ä¸€ä»‹ç»è·å–ç±»ä¸­å±æ€§å’Œæ–¹æ³•çš„æ–¹æ³•ã€‚å½“ç„¶ä¸è¦å¿˜äº†<code class="language-plaintext highlighter-rouge">#import &lt;objc/runtime.h&gt;</code>.</p>

<h4 id="è·å–ç±»çš„åç§°">è·å–ç±»çš„åç§°</h4>

<p>æ–¹æ³•ï¼š<code class="language-plaintext highlighter-rouge">const char *object_getClassName(id obj)</code>ï¼Œä½¿ç”¨æ¯”è¾ƒç®€å•ï¼Œä¼ å…¥å¯¹è±¡å³å¯å¾—åˆ°å¯¹åº”åˆ†ç±»åã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ClassA *classA = [[ClassA alloc] init];
const char *className = object_getClassName(classA);
NSLog(@"className = %@", [NSString stringWithUTF8String:className]);

//è¾“å‡º
className = ClassA
</code></pre></div></div>

<h4 id="è·å–ç±»ä¸­çš„æ–¹æ³•">è·å–ç±»ä¸­çš„æ–¹æ³•</h4>

<p>æ–¹æ³•ï¼š<code class="language-plaintext highlighter-rouge">Method *class_copyMethodList(Class cls, unsigned int *outCount) </code></p>

<p>ä¸Šä»£ç ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>UInt32 count;
char dst;
Method *methods = class_copyMethodList([classA class], &amp;count);//è·å–æ–¹æ³•åˆ—è¡¨
for (int i = 0; i &lt; count; i++) {
    Method method = methods[i];// è·å–æ–¹æ³•
    SEL methodName = method_getName(method);// è·å–æ–¹æ³•å
    method_getReturnType(method, &amp;dst, sizeof(char));// è·å–æ–¹æ³•è¿”å›ç±»å‹
    const char *methodType = method_getTypeEncoding(method);// è·å–æ–¹æ³•å‚æ•°ç±»å‹å’Œè¿”å›ç±»å‹
    NSLog(@"methodName = %@",NSStringFromSelector(methodName));
    NSLog(@"dst = %c", dst);
}
    
 // è¾“å‡º
 methodName = methodAOfClassAWithArg:
 dst = v
 methodType = v24@0:8@16
 methodName = MethodBOfClassAWithArg:
 dst = v
 methodType = v24@0:8@16
 methodName = publicProperty1
 dst = @
 methodType = @16@0:8
 methodName = setPublicProperty1:
 dst = v
 methodType = v24@0:8@16
 methodName = publicProperty2
 dst = @
 methodType = @16@0:8
 methodName = setPublicProperty2:
 dst = v
 methodType = v24@0:8@16
 methodName = privateProperty1
 dst = @
 methodType = @16@0:8
 methodName = setPrivateProperty1:
 dst = v
 methodType = v24@0:8@16
 methodName = privateProperty2
 dst = @
 methodType = @16@0:8
 methodName = setPrivateProperty2:
 dst = v
 methodType = v24@0:8@16
 methodName = .cxx_destruct
 dst = v
 methodType = v16@0:8

</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">class_copyMethodList([classA class], &amp;count)</code> ä¼ å…¥å…ƒç±»å’Œè®¡æ•°å™¨åœ°å€ï¼Œè¿”å›æ–¹æ³•åˆ—è¡¨ã€‚è¿™é‡Œæ³¨æ„ï¼Œè¿”å›çš„æ˜¯<code class="language-plaintext highlighter-rouge">Method</code>ç»“æ„ä½“ç±»å‹çš„Cæ•°ç»„ï¼Œ<code class="language-plaintext highlighter-rouge">Method</code>ç±»å‹æˆ‘ä»¬åœ¨<a href="http://www.jianshu.com/p/a36bfc976b8e">ä¸Šç¯‡æ–‡ç« </a>ä¸­å·²ç»è¯¦ç»†è¯´æ˜ï¼Œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>typedef struct objc_method *Method;

struct objc_method {
    SEL method_name                                          OBJC2_UNAVAILABLE;
    char *method_types                                       OBJC2_UNAVAILABLE;
    IMP method_imp                                           OBJC2_UNAVAILABLE;
} 
</code></pre></div></div>

<p>ä½†è¦åŒºåˆ†<code class="language-plaintext highlighter-rouge">Method *methods</code>ä¸<code class="language-plaintext highlighter-rouge">Method method</code>çš„åŒºåˆ«ï¼Œè¿™æ˜¯æ¯”è¾ƒåŸºç¡€Cè¯­è¨€çŸ¥è¯†ã€‚è¿˜æœ‰<code class="language-plaintext highlighter-rouge">Uint32</code>æ˜¯OCå®šä¹‰çš„<code class="language-plaintext highlighter-rouge">unsigned int</code>ç±»å‹<code class="language-plaintext highlighter-rouge">typedef unsigned int UInt32;</code></p>

<p>è¿™é‡Œæˆ‘ä»¬æ¥çœ‹çœ‹ <code class="language-plaintext highlighter-rouge">method_getReturnType(method, &amp;dst, sizeof(char))</code> æ–¹æ³•ç®€å•è¾“å‡ºè¿”å›å€¼ç±»å‹ï¼Œè¾“å‡ºä¸º <code class="language-plaintext highlighter-rouge">v</code> å’Œ <code class="language-plaintext highlighter-rouge">@</code> ,å‚è€ƒAppleæ–‡æ¡£å¯çŸ¥é“è¿”å›ç±»å‹ä¸º <code class="language-plaintext highlighter-rouge">void</code> å’Œ <code class="language-plaintext highlighter-rouge">id</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A void v
A method selector (SEL)  ï¼š
An object (whether statically typed or typed id) @ 
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">method_getTypeEncoding(method)</code>æ–¹æ³•å¯ä»¥è¾“å‡ºè¿”å›å€¼ï¼Œå‚æ•°ç±»å‹ä»¥åŠæ¥æ”¶å™¨ç±»å‹ã€‚æˆ‘ä»¬çœ‹è¾“å‡ºçš„<code class="language-plaintext highlighter-rouge">v24@0:8@16</code>ï¼Œåˆ†æä¸Šé¢çš„è¯´æ˜å°±å¯ä»¥çŸ¥é“ï¼š <code class="language-plaintext highlighter-rouge">v24</code>è¿”å›ç±»å‹ä¸º<code class="language-plaintext highlighter-rouge">viod</code>,<code class="language-plaintext highlighter-rouge">@0</code>æ¥æ”¶å™¨ç±»å‹ä¸º<code class="language-plaintext highlighter-rouge">id</code>,<code class="language-plaintext highlighter-rouge">@16</code>å‚æ•°ç±»å‹ä¸º<code class="language-plaintext highlighter-rouge">id</code></p>

<p>è‡³äºç±»å‹åé¢çš„å€¼è§‚å¯Ÿå¯ä»¥å‘ç°éƒ½æ˜¯ç›¸å·®8ï¼Œæˆ‘è®¤ä¸ºæ˜¯åœ¨methodä¸­çš„ä½ç½®ï¼Œåˆ†åˆ«ä»¥8bitå­˜å‚¨ä¸åŒç±»å‹çš„æ•°æ®ã€‚</p>

<p>è‹¥æœ‰ä¸¤ä¸ªå‚æ•°è¿”å›å€¼ä¸º <code class="language-plaintext highlighter-rouge">v32@0:8@16@24</code> ,å¯¹æ¯”å¯ä»¥çŒœæµ‹ï¼Œåœ¨methodä¸­å„ä¸ªæˆå‘˜çš„æ’åˆ—æ˜¯è¿™æ ·çš„ï¼š <code class="language-plaintext highlighter-rouge">æ¥æ”¶å™¨|SElæ ‡è¯†|å‚æ•°1|å‚æ•°2|...|è¿”å›å€¼</code>ï¼Œç„¶åç”± <code class="language-plaintext highlighter-rouge">method_getTypeEncoding(method)</code> è¾“å‡ºçš„é¡ºåºä¸º: <code class="language-plaintext highlighter-rouge">è¿”å›å€¼ç±»å‹|æ¥æ”¶å™¨ç±»å‹|SELæ ‡è¯†|å‚æ•°1|å‚æ•°2|...</code> æ­¤å¤„ä¸ºä¸ªäººè§è§£ï¼Œå¦‚æœ‰é”™è¯¯æˆ–ä¸åŒæ„è§æ¬¢è¿æå‡ºæ¢è®¨ã€‚</p>

<p>æœ€åå‘ç°äº†ä¸€ä¸ªå¥‡æ€ªçš„æ–¹æ³• <code class="language-plaintext highlighter-rouge">.cxx_destruct</code> ,åœ¨ä¸­<a href="http://my.safaribooksonline.com/book/programming/objective-c/9780132908641/3dot-memory-management/ch03">è¿™ç¯‡æ–‡ç« </a>ä¸­ï¼š</p>
<blockquote>
  <p>ARC actually creates a -.cxx_destruct method to handle freeing instance variables. This method was originally created for calling C++ destructors automatically when an object was destroyed.</p>
</blockquote>

<p>å’Œã€ŠEffective Objective-C 2.0ã€‹ä¸­æåˆ°çš„ï¼š</p>
<blockquote>
  <p>When the compiler saw that an object contained C++ objects, it would generate a method called .cxx_destruct. ARC piggybacks on this method and emits the required cleanup code within it.</p>
</blockquote>

<p>å¯ä»¥äº†è§£åˆ°ï¼Œ<code class="language-plaintext highlighter-rouge">.cxx_destruct</code> æ–¹æ³•åŸæœ¬æ˜¯ä¸ºäº†C++å¯¹è±¡ææ„çš„ï¼ŒARCå€Ÿç”¨äº†è¿™ä¸ªæ–¹æ³•æ’å…¥ä»£ç å®ç°äº†è‡ªåŠ¨å†…å­˜é‡Šæ”¾çš„å·¥ä½œ</p>

<p>å…³äº <code class="language-plaintext highlighter-rouge">.cxx_destruct</code> å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« :<a href="http://blog.jobbole.com/65028/">ARCä¸‹deallocè¿‡ç¨‹åŠ.cxx_destructçš„æ¢ç©¶</a></p>

<h4 id="è·å–ç±»ä¸­çš„å±æ€§">è·å–ç±»ä¸­çš„å±æ€§</h4>

<p>åœ¨ <a href="http://www.jianshu.com/p/a36bfc976b8e">ä¸Šç¯‡æ–‡ç« </a> çš„ <code class="language-plaintext highlighter-rouge">Property</code> ä¸­æˆ‘ä»¬ä¹Ÿæåˆ°äº†è·å–ç±»ä¸­çš„å±æ€§çš„æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>id LenderClass = objc_getClass("ClassA");//è·å–classA çš„å…ƒç±»åŒ[ClassA class]
unsigned int outCount;//å±æ€§æ•°é‡
// è·å–å±æ€§åˆ—è¡¨
objc_property_t *properties = class_copyPropertyList(LenderClass, &amp;outCount);

// éå†
for (int i = 0; i &lt; outCount; i++) {

    objc_property_t property = properties[i];
    
    const char *propertyName = property_getName(property);// è·å–å±æ€§å
    const char *propertyAttributes = property_getAttributes(property);// è·å–å±æ€§æè¿°
    
    printf("propertyNameï¼š%s \n", propertyName);
    printf("propertyAttributes:%s\n--------\n", propertyAttributes);//å±æ€§ååŠæè¿°
}
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// è¾“å‡º
propertyNameï¼šprivateProperty1 
propertyAttributes:T@"NSString",C,N,V_privateProperty1
--------
propertyNameï¼šprivateProperty2 
propertyAttributes:T@"NSString",C,N,V_privateProperty2
--------
propertyNameï¼špublicProperty1 
propertyAttributes:T@"NSString",C,N,V_publicProperty1
--------
propertyNameï¼špublicProperty2 
propertyAttributes:T@"NSString",C,N,V_publicProperty2
--------
</code></pre></div></div>
<p>å‘ç°ä¼šè¾“å‡ºå…¬æœ‰å±æ€§ä»¥åŠç§æœ‰å±æ€§ã€‚</p>

<h4 id="è·å–ç±»ä¸­çš„æˆå‘˜å˜é‡">è·å–ç±»ä¸­çš„æˆå‘˜å˜é‡</h4>

<p>æˆ‘ä»¬å¯ä»¥å‘ç°è·å–ç±»ä¸­çš„æ–¹æ³•ï¼Œå±æ€§è¿‡ç¨‹åŸºæœ¬ä¸€è‡´ï¼šé€šè¿‡å…ƒç±»è·å–æ–¹æ³•åˆ—è¡¨æˆ–å±æ€§åˆ—è¡¨ï¼Œç„¶ååœ¨è¿›è¡Œéå†ã€‚è·å–æˆå‘˜å˜é‡ä¹Ÿä¸€æ ·ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>id selfClass = [Calss class];
unsigned int numIvars = 0;
Ivar *ivars = class_copyIvarList(selfClass, &amp;numIvars);
for(int i = 0; i &lt; numIvars; i++) {
    Ivar ivar = ivars[i];
    const char *ivarName = ivar_getName(ivar);
    const char *ivarType = ivar_getTypeEncoding(ivar);// è·å–ç±»å‹
    
    printf("ivarName:%s\n", ivarName);
    printf("ivarType:%s\n------\n", ivarType);
}
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// è¾“å‡º
ivarName:_publicVar1
ivarType:@"NSString"
------
ivarName:_publicVar2
ivarType:@"NSString"
------
ivarName:_privateVar1
ivarType:@"NSString"
------
ivarName:_privateVar2
ivarType:@"NSString"
------
ivarName:_publicProperty1
ivarType:@"NSString"
------
ivarName:_publicProperty2
ivarType:@"NSString"
------
ivarName:_privateProperty1
ivarType:@"NSString"
------
ivarName:_privateProperty2
ivarType:@
</code></pre></div></div>
<p>å¯ä»¥å‘ç°è¾“å‡ºäº†æ‰€æœ‰çš„æˆå‘˜å˜é‡ï¼ŒåŒ…æ‹¬å±æ€§å£°æ˜çš„ <code class="language-plaintext highlighter-rouge">_+å±æ€§å</code> å˜é‡ã€‚</p>

<h2 id="ç»™åˆ†ç±»æ·»åŠ å±æ€§">ç»™åˆ†ç±»æ·»åŠ å±æ€§</h2>
<hr />

<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œåˆ†ç±»ä¸­æ˜¯ä¸èƒ½å£°æ˜å±æ€§çš„ã€‚</p>

<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code class="language-plaintext highlighter-rouge">CalssA</code> çš„åˆ†ç±» <code class="language-plaintext highlighter-rouge">ClassA+CategoryA</code> ,åœ¨ <code class="language-plaintext highlighter-rouge">ClassA+CategoryA</code> ä¸­æ·»åŠ ä¸€ä¸ªå±æ€§ <code class="language-plaintext highlighter-rouge">name</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#import "ClassA.h"

@interface ClassA (CategoryA)

@property (nonatomic, strong) NSString *name;

@end

</code></pre></div></div>

<p>è‹¥åœ¨æˆ‘ä»¬è°ƒç”¨<code class="language-plaintext highlighter-rouge">CalssA</code>åˆ†ç±»çš„<code class="language-plaintext highlighter-rouge">name</code> å°†ä¼šcrashï¼ŒåŸå› æ˜¯åˆ†ç±»ä¸­ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">@property</code> å£°æ˜å±æ€§å¹¶ä¸ä¼šç”Ÿæˆ<code class="language-plaintext highlighter-rouge">setter</code>å’Œ<code class="language-plaintext highlighter-rouge">getter</code>æ–¹æ³•,ä½†æ˜¯æˆ‘ä»¬ä¼šæƒ³ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å®ç°å‘€ï¼Œæ²¡é”™ï¼Œçœ‹ä¸‹é¢çš„ä»£ç </p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#import "ClassA+CategoryA.h"
#import &lt;objc/runtime.h&gt;

@implementation ClassA (CategoryA)

- (NSString *)name {
    return name;
}

- (void)setName:(NSString *)name {
    _name = name;
}

@end
</code></pre></div></div>
<p>è¿™é‡Œä¼šæŠ¥ç¼–è¯‘é”™è¯¯ï¼Œå› ä¸ºåˆ†ç±»ä¸­ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">@property</code> å£°æ˜å±æ€§ä¹Ÿä¸ä¼šç”Ÿæˆæˆå‘˜å˜é‡ _nameï¼Œå¹¶ä¸”æ‰‹åŠ¨å£°æ˜ä¹Ÿä¸è¡Œ</p>

<p><img src="http://ww1.sinaimg.cn/large/7853084cgw1f9zsknx42yj20fw033gm0.jpg" alt="" /></p>

<p>ç¼–è¯‘é”™è¯¯ï¼Œæç¤ºå®ä¾‹å˜é‡æ— æ³•æ·»åŠ åˆ°åˆ†ç±»ä¸­ï¼Œç”¨æ­£å¸¸çš„æ–¹æ³•ç¡®å®æ— æ³•åœ¨åˆ†ç±»ä¸­æ·»åŠ å±æ€§ã€‚</p>

<p>ä½†æ˜¯å¯ä»¥é€šè¿‡Runtimæœºåˆ¶è¿›è¡Œâ€œæ·»åŠ â€ã€‚å…¶æœ¬è´¨æ˜¯ç»™è¿™ä¸ªç±»æ·»åŠ å±æ€§å…³è”ï¼Œè€ŒéæŠŠè¿™ä¸ªå±æ€§æ·»åŠ åˆ°ç±»ä¸­ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#import "ClassA+CategoryA.h"
#import &lt;objc/runtime.h&gt;


@implementation ClassA (CategoryA)

- (NSString *)name {
    return objc_getAssociatedObject(self, @selector(name));
}

- (void)setName:(NSString *)name {
    objc_setAssociatedObject(self, @selector(name), name, OBJC_ASSOCIATION_COPY_NONATOMIC);
}

@end
</code></pre></div></div>

<p>è°ƒç”¨ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>classA.name = @"é‚±å¸…";
NSLog(@"%@",classA.name);

// è¾“å‡º
2016-11-21 16:18:48.084 UseRuntime[4392:1325037] é‚±å¸…
</code></pre></div></div>
<p>å¯ä»¥çœ‹å‡ºæ·»åŠ å±æ€§æˆåŠŸï¼</p>

<p>æˆ‘ä»¬æ¥çœ‹çœ‹å…³è”å±æ€§çš„è¿™å‡ ä¸ªæ–¹æ³•ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OBJC_EXPORT void objc_setAssociatedObject(id object, const void *key, id value, objc_AssociationPolicy policy)
    OBJC_AVAILABLE(10.6, 3.1, 9.0, 1.0);
    
OBJC_EXPORT id objc_getAssociatedObject(id object, const void *key)
    OBJC_AVAILABLE(10.6, 3.1, 9.0, 1.0);
    
OBJC_EXPORT void objc_removeAssociatedObjects(id object)
    OBJC_AVAILABLE(10.6, 3.1, 9.0, 1.0);

</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">objc_setAssociatedObject()</code> æ–¹æ³•ä¸ºå…³è”å±æ€§ï¼Œå‚æ•°å¦‚ä¸‹ï¼š</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">object</code>ï¼šå±æ€§å…³è”çš„æºå¯¹è±¡ï¼Œè¿™é‡Œä½¿ç”¨äº†<code class="language-plaintext highlighter-rouge">self</code>ï¼Œä»£è¡¨å…³è”æœ¬ç±»çš„å¯¹è±¡</li>
  <li><code class="language-plaintext highlighter-rouge">key</code>:åŒºåˆ†å±æ€§çš„å”¯ä¸€æ ‡è¯†ï¼Œå› ä¸ºå…³è”çš„å±æ€§å¯èƒ½ä¸æ­¢ä¸€ä¸ªï¼Œæˆ‘ä»¬ä½¿ç”¨äº†<code class="language-plaintext highlighter-rouge">- (NSString *)name</code>æ–¹æ³•çš„<code class="language-plaintext highlighter-rouge">SEL</code> <code class="language-plaintext highlighter-rouge">@selector(name)</code>ä½œä¸ºå”¯ä¸€æ ‡ç¤ºï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³•æ¥ç”ŸæˆKey :</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//åˆ©ç”¨é™æ€å˜é‡åœ°å€å”¯ä¸€ä¸å˜çš„ç‰¹æ€§
1ã€static void *strKey = &amp;strKey;

2ã€static NSString *strKey = @"strKey"; 

3ã€static char strKey;
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">value</code>ï¼šå…³è”çš„å±æ€§å€¼</li>
  <li><code class="language-plaintext highlighter-rouge">policy</code>ï¼šè®¾ç½®å…³è”å¯¹è±¡çš„<code class="language-plaintext highlighter-rouge">copy</code>ã€<code class="language-plaintext highlighter-rouge">story</code>ã€<code class="language-plaintext highlighter-rouge">nonatomic</code>ç­‰å‚æ•°:</li>
</ul>

<p>è¿™äº›å¸¸é‡å¯¹åº”ç€å¼•ç”¨å…³è”å€¼çš„æ”¿ç­–ï¼Œä¹Ÿå°±æ˜¯ Objc å†…å­˜ç®¡ç†çš„å¼•ç”¨è®¡æ•°æœºåˆ¶ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>typedef OBJC_ENUM(uintptr_t, objc_AssociationPolicy) {
    OBJC_ASSOCIATION_ASSIGN = 0,           
    OBJC_ASSOCIATION_RETAIN_NONATOMIC = 1,              
    OBJC_ASSOCIATION_COPY_NONATOMIC = 3,                                                  
    OBJC_ASSOCIATION_RETAIN = 01401,       
    OBJC_ASSOCIATION_COPY = 01403                                               
};
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">objc_getAssociatedObject()</code> æ–¹æ³•é€šè¿‡ <code class="language-plaintext highlighter-rouge">object</code> ä¸ <code class="language-plaintext highlighter-rouge">Key</code> ç›´æ¥è·å–å…³è”çš„å±æ€§å€¼</p>

<p><code class="language-plaintext highlighter-rouge">objc_removeAssociatedObjects()</code> ç§»é™¤å…³è”</p>

<p>æˆ‘ä»¬ä½¿ç”¨ä¸Šé¢çš„è·å–ç±»ä¸­å±æ€§å’Œæˆå‘˜å˜é‡çš„æ–¹æ³•ï¼Œå‘ç°è¾“å‡ºï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// æœ‰å±æ€§è¾“å‡º
propertyNameï¼šname 
propertyAttributes:T@"NSString",&amp;,N
</code></pre></div></div>
<p>æ²¡æœ‰æˆå‘˜å˜é‡ <code class="language-plaintext highlighter-rouge">_name</code>ï¼Œè¿›ä¸€æ­¥è¯´æ˜åˆ†ç±»ä¸­ä¸èƒ½æ·»åŠ æˆå‘˜å˜é‡ï¼å…¶æœ¬è´¨æ˜¯æ·»åŠ å±æ€§ä¸åˆ†ç±»ä¹‹é—´å…³è”ã€‚</p>

<h2 id="æ›´æ¢ä»£ç å®ç°æ–¹æ³•method-swizzling">æ›´æ¢ä»£ç å®ç°æ–¹æ³•ï¼ˆMethod Swizzlingï¼‰</h2>
<hr />
<p>åœ¨<a href="http://www.jianshu.com/p/a36bfc976b8e">ä¸Šç¯‡</a>ä¸­è¯¦ç»†ä»‹ç»äº†<code class="language-plaintext highlighter-rouge">Method Swizzling</code>çš„åŸç†ï¼Œå…¶æœ¬è´¨æ˜¯æ›´æ¢äº† <code class="language-plaintext highlighter-rouge">selector</code> çš„ <code class="language-plaintext highlighter-rouge">IMP</code> ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#import "ViewController.h"
#import &lt;objc/runtime.h&gt;
#import "ClassA.h"
#import "ClassB.h"

@interface ViewController ()

@end

@implementation ViewController

+ (void)load {
    Method classA_method = class_getInstanceMethod([ClassA class], @selector(methodAOfClassAWithArg:));
    Method classB_method = class_getInstanceMethod([ClassB class], @selector(methodAOfClassBWithArg:));
    method_exchangeImplementations(classA_method, classB_method);
}
- (void)viewDidLoad {
    [super viewDidLoad];
    
    [classA methodAOfClassAWithArg:@"classA å‘å‡ºçš„ Aæ–¹æ³•"];
    [classB methodAOfClassBWithArg:@"classB å‘å‡ºçš„ Aæ–¹æ³•"];
}    

// è¾“å‡º

2016-11-22 13:07:15.151 UseRuntime[1015:533335]  methodAOfClassB arg = classA å‘å‡ºçš„ Aæ–¹æ³•
2016-11-22 13:07:15.151 UseRuntime[1015:533335]  methodAOfClassA arg = classB å‘å‡ºçš„ Aæ–¹æ³•
</code></pre></div></div>

<p>é¦–å…ˆäº¤æ¢æ–¹æ³•å†™åœ¨ <code class="language-plaintext highlighter-rouge">+(void)load</code>,åœ¨ç¨‹åºçš„ä¸€å¼€å§‹å°±è°ƒç”¨æ‰§è¡Œï¼Œä½ å°†ä¸ä¼šç¢°åˆ°å¹¶å‘é—®é¢˜ã€‚</p>

<p>æˆ‘ä»¬å¯ä»¥å‘ç°ä¸¤ä¸ªæ–¹æ³•çš„å®ç°è¿‡ç¨‹ä»¥åŠå¯¹æ¢ã€‚</p>

<p>å½“ç„¶ï¼Œå¹³æ—¶ä½¿ç”¨æˆ‘ä»¬å¹¶ä¸ä¼šè¿™ä¹ˆåšï¼Œå½“æˆ‘ä»¬è¦åœ¨ç³»ç»Ÿæä¾›çš„æ–¹æ³•ä¸Šå†æ‰©å……åŠŸèƒ½æ—¶(ä¸èƒ½é‡å†™ç³»ç»Ÿæ–¹æ³•)ï¼Œå°±å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">Method Swizzling</code>.</p>

<p>æˆ‘ä»¬ç»™<code class="language-plaintext highlighter-rouge">NSArray</code>æ·»åŠ ä¸€ä¸ªåˆ†ç±»<code class="language-plaintext highlighter-rouge">AddLog</code>,ç»™ <code class="language-plaintext highlighter-rouge">arrayByAddingObject:</code>æ–¹æ³•æ·»åŠ ä¸€ä¸ªè¾“å‡ºæ–¹æ³•ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#import "NSArray+AddLog.h"
#import &lt;objc/runtime.h&gt;

@implementation NSArray (AddLog)

+ (void)load {

    SEL ori_selector = @selector(arrayByAddingObject:);
    SEL my_selector = @selector(my_arrayByAddingObject:);
    
    Method ori_method = class_getInstanceMethod([NSArray class], ori_selector);
    Method my_method  = class_getInstanceMethod([NSArray class], my_selector);
    
    if (([NSArray class], ori_selector, method_getImplementation(my_method), method_getTypeEncoding(my_method))) {
        
        class_replaceMethod([NSArray class], my_selector, method_getImplementation(ori_method), method_getTypeEncoding(ori_method));
        
    } else {
        method_exchangeImplementations(ori_method, my_method);
    }

}

- (NSArray *)my_arrayByAddingObject:(id)anObject {

    NSArray *array = [self my_arrayByAddingObject:anObject];
    NSLog(@"æ·»åŠ äº†ä¸€ä¸ªå…ƒç´  %@", anObject);
    return array;
}

@end

</code></pre></div></div>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸‰ä¸ªæ–¹æ³•ï¼š</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">class_addMethod()</code>ï¼šç»™ä¸€ä¸ªæ–¹æ³•æ·»åŠ æ–°çš„æ–¹æ³•å’Œå®ç°</li>
  <li><code class="language-plaintext highlighter-rouge">class_replaceMethod(ï¼‰</code>ï¼šå–ä»£äº†å¯¹äºä¸€ä¸ªç»™å®šçš„ç±»çš„å®ç°æ–¹æ³•</li>
  <li><code class="language-plaintext highlighter-rouge">method_exchangeImplementations(ï¼‰</code>ï¼šäº¤æ¢ä¸¤ä¸ªç±»çš„å®ç°æ–¹æ³•</li>
</ul>

<p>è¿™é‡Œæˆ‘ä»¬å…ˆä½¿ç”¨ <code class="language-plaintext highlighter-rouge">class_addMethod()</code> åœ¨ç±»ä¸­æ·»åŠ æ–¹æ³•ï¼Œè‹¥è¿”å›Yesè¯´æ˜ç±»ä¸­æ²¡æœ‰è¯¥æ–¹æ³•ï¼Œç„¶åå†ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">class_replaceMethod()</code> æ–¹æ³•è¿›è¡Œå–ä»£;è‹¥è¿”å›NOï¼Œè¯´æ˜ç±»ä¸­æœ‰è¯¥æ–¹æ³•ï¼Œä½¿ç”¨<code class="language-plaintext highlighter-rouge">method_exchangeImplementations()</code>ç›´æ¥äº¤æ¢ä¸¤è€…çš„ <code class="language-plaintext highlighter-rouge">IMP</code>.</p>

<p>å…¶å®åœ¨è¿™é‡Œç›´æ¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">method_exchangeImplementations()</code>è¿›è¡Œäº¤æ¢å°±å¯ä»¥äº†ã€‚å› ä¸ºç±»ä¸­å¿…å®šæœ‰<code class="language-plaintext highlighter-rouge">arrayByAddingObjectï¼š</code>æ–¹æ³•ã€‚</p>

<p>æˆ‘ç»™æˆ‘ä»¬è‡ªå·±çš„æ–¹æ³•å‘½åä¸º<code class="language-plaintext highlighter-rouge">my_arrayByAddingObject:</code>,åœ¨åŸæ¥çš„æ–¹æ³•åä¸ŠåŠ ä¸Šå‰ç¼€ï¼Œæ—¢å¯ä»¥é˜²æ­¢å‘½åå†²çªï¼Œåˆæ–¹ä¾¿é˜…è¯»ï¼Œåœ¨æˆ‘ä»¬<code class="language-plaintext highlighter-rouge">my_arrayByAddingObject:</code>æ–¹æ³•ä¸­è°ƒç”¨æœ¬èº«</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NSArray *array = [self my_arrayByAddingObject:anObject];
</code></pre></div></div>

<p>çœ‹ä¼¼ä¼šé™·å…¥é€’å½’è°ƒç”¨ï¼Œå…¶å®åˆ™ä¸ä¼šï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åœ¨<code class="language-plaintext highlighter-rouge">+ (void)load </code>æ–¹æ³•ä¸­æ›´æ¢äº†<code class="language-plaintext highlighter-rouge">IMP</code>,ä»–ä¼šè°ƒç”¨<code class="language-plaintext highlighter-rouge">arrayByAddingObject:</code>æ–¹æ³•ï¼Œç„¶ååœ¨åé¢æ·»åŠ æˆ‘ä»¬éœ€è¦æ·»åŠ çš„åŠŸèƒ½ã€‚</p>

<p><code class="language-plaintext highlighter-rouge">arrayByAddingObject:</code>æ–¹æ³•çš„è°ƒç”¨ä¸å˜ï¼›</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NSArray *arr1 = @[@"one", @"two"];
NSArray *arr2 = [arr1 arrayByAddingObject:@"three"];
NSLog(@"arr2 = %@", arr2);
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// è¾“å‡º
2016-11-22 13:57:00.021 UseRuntime[1147:743449] æ·»åŠ äº†ä¸€ä¸ªå…ƒç´  three
2016-11-22 13:57:00.021 UseRuntime[1147:743449] arr2 = (
    one,
    two,
    three
)
</code></pre></div></div>

<h2 id="åŠ¨æ€æ·»åŠ æ–¹æ³•">åŠ¨æ€æ·»åŠ æ–¹æ³•</h2>

<p>åŠ¨æ€æ·»åŠ æ–¹æ³•å°±æ˜¯åœ¨æ¶ˆæ¯è½¬å‘å‰åœ¨<code class="language-plaintext highlighter-rouge">+ (BOOL)resolveInstanceMethod:(SEL)sel</code>æ–¹æ³•ä¸­ä½¿ç”¨<code class="language-plaintext highlighter-rouge">class_addMethod()</code> æ·»åŠ æ–¹æ³•ã€‚</p>

<p>ä¸‹é¢æˆ‘é¢æ·»åŠ ä¸€ä¸ªåä¸º<code class="language-plaintext highlighter-rouge">resolveThisMethodDynamically</code>çš„æ–¹æ³•ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>void dynamicMethodIMP(id self, SEL _cmd) {
    // implementation ....
    printf("æ‰§è¡Œäº†dynamicMethodIMP!!!!");
}

+ (BOOL)resolveInstanceMethod:(SEL)sel {
    
    if (sel == @selector(resolveThisMethodDynamically)) {
        class_addMethod([self class], sel, (IMP) dynamicMethodIMP, "v@:");
        return YES;
    }
    return [super resolveInstanceMethod:sel];
}
</code></pre></div></div>
<p>è°ƒç”¨ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>performSelector:@selector(resolveThisMethodDynamically)];

// è¾“å‡º
æ‰§è¡Œäº†dynamicMethodIMP!!!!
</code></pre></div></div>
<p>å¯¹äºä¸Šé¢æ·»åŠ çš„çš„æ–¹æ³• <code class="language-plaintext highlighter-rouge">resolveThisMethodDynamically</code> ï¼Œä½¿ç”¨ <code class="language-plaintext highlighter-rouge">[self performSelector:@selector(resolveThisMethodDynamically)]</code> è¿›è¡Œè°ƒç”¨ï¼Œä¸èƒ½ä½¿ç”¨<code class="language-plaintext highlighter-rouge">[self resolveThisMethodDynamically]</code>,å› ä¸ºå‹æ ¹å°±æ²¡æœ‰å£°æ˜ <code class="language-plaintext highlighter-rouge">-(void)resolveThisMethodDynamically</code>,ä¼šæŠ¥ç¼–è¯‘é”™è¯¯ã€‚</p>

<p>æ•´ä¸ªè¿‡ç¨‹å°±æ˜¯ï¼Œ<code class="language-plaintext highlighter-rouge">performSelector:</code>è°ƒç”¨<code class="language-plaintext highlighter-rouge">resolveThisMethodDynamically</code>æ–¹æ³•ï¼Œç„¶ååœ¨åˆ—è¡¨ä¸­æ‰¾ä¸åˆ°ï¼ˆå› ä¸ºç±»ä¸­æ ¹æœ¬å°±æ²¡æœ‰æ³¨å†Œè¯¥æ–¹æ³•ï¼‰ï¼Œç„¶åè·³å…¥ <code class="language-plaintext highlighter-rouge">+ (BOOL)resolveInstanceMethod:</code> ä¸­ï¼Œæˆ‘ä»¬å†ä¸º<code class="language-plaintext highlighter-rouge">resolveThisMethodDynamically</code>æ–¹æ³•æ·»åŠ å…·ä½“å®ç°ã€‚</p>

<h2 id="å­—å…¸è½¬å±æ€§">å­—å…¸è½¬å±æ€§</h2>

<p>å°†å­—å…¸è½¬åŒ–ä¸ºæ¨¡å‹ï¼Œæ˜¯åœ¨æˆ‘ä»¬iOSå¼€å‘ä¸­æœ€ä¸ºå¸¸ç”¨çš„æŠ€èƒ½ã€‚iOSçš„æ¨¡å‹æ¡†æ¶å¦‚<code class="language-plaintext highlighter-rouge">JSONModel</code>,<code class="language-plaintext highlighter-rouge">MJExtension</code>,<code class="language-plaintext highlighter-rouge">MJExtension</code>ç­‰çš†æ˜¯åˆ©ç”¨äº†runtimeï¼Œå°†å­—å…¸è½¬ä¸ºæ¨¡å‹ï¼Œä¸è¿‡å…¼é¡¾çš„ç»†èŠ‚æ›´å¤šã€‚ä¸‹é¢æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªç®€æ˜“çš„å­—å…¸è½¬æ¨¡å‹æ¡†æ¶ã€‚</p>

<p>å…ˆä¸Šä»£ç ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#import "NSObject+BYModel.h"
#import &lt;objc/runtime.h&gt;
#import &lt;objc/message.h&gt;

@implementation NSObject (BYModel)

- (void)by_modelSetDictionary:(NSDictionary *)dic {

    Class cls = [self class];
    
    // éå†æœ¬ç±»å’Œçˆ¶ç±»çš„å˜é‡
    while (cls) {
        //è·å–æ‰€æœ‰æˆå‘˜å˜é‡
        unsigned int outCount = 0;
        Ivar *ivars = class_copyIvarList(cls, &amp;outCount);
        
        for (int i = 0; i &lt; outCount; i++) {
            Ivar ivar = ivars[i];
            
            // è·å–å˜é‡å
            NSMutableString *ivar_Name = [NSMutableString stringWithUTF8String:ivar_getName(ivar)];
        
            [ivar_Name replaceCharactersInRange:NSMakeRange(0, 1) withString:@""];// _ivar -&gt; ivar
            
            //
            NSString *key = [ivar_Name copy];
            if ([key isEqualToString:@"dece"]) {
                key = @"description";
            }
            if ([key isEqualToString:@"ID"]) {
                key = @"id";
            }
            
            id value = dic[key];
            if (!value) continue;
            
            // æ‹¼æ¥SEL    ivar -&gt; setIvar:
            
            NSString *cap = [ivar_Name substringToIndex:1];
            cap = cap.uppercaseString; // a-&gt;A
            [ivar_Name replaceCharactersInRange:NSMakeRange(0, 1) withString:cap];
            [ivar_Name insertString:@"set" atIndex:0];
            [ivar_Name appendString:@":"];
            
            SEL selector = NSSelectorFromString(ivar_Name);
            
            // åˆ¤æ–­ç±»å‹å¹¶å‘é€æ¶ˆæ¯
            NSString *type = [NSString stringWithUTF8String:ivar_getTypeEncoding(ivar)];
            
            if ([type hasPrefix:@"@"]) { // å¯¹è±¡ç±»å‹
                objc_msgSend(self, selector, value);
            } else { // éå¯¹è±¡ç±»å‹
                if ([type isEqualToString:@"d"]) {
                    objc_msgSend(self, selector, [value doubleValue]);
                } else if ([type isEqualToString:@"f"]) {
                    objc_msgSend(self, selector, [value floatValue]);
                } else if ([type isEqualToString:@"i"]) {
                    objc_msgSend(self, selector, [value intValue]);
                } else {
                    objc_msgSend(self, selector, [value longLongValue]);
                }
            }
            
            
        }
        // è·å–çˆ¶ç±»è¿›è¡Œéå†å˜é‡
        cls = class_getSuperclass(cls);
    }
    
}

</code></pre></div></div>

<p>è¿™ä¸ªè¿™ä¸ªæ®µä»£ç å¯èƒ½å‡ºç°ç¼–è¯‘é”™è¯¯ï¼š</p>

<p><img src="http://ww3.sinaimg.cn/large/7853084cgw1fa3b5fbvsqj20k001fjrn.jpg" alt="" /></p>

<p>è§£å†³åŠæ³•å¾ˆç®€å•ï¼š</p>

<p>å°†é¡¹ç›® Project -&gt; Build Settings -&gt; Enable strct checking of objc_msgSend Calls è®¾ç½®ä¸º <strong>NO</strong> å³å¯</p>

<p><img src="http://ww1.sinaimg.cn/large/7853084cgw1fa3b6mm9h7j20oh0aj0v8.jpg" alt="" /></p>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ¨¡å‹ç±»<code class="language-plaintext highlighter-rouge">Student</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#import &lt;Foundation/Foundation.h&gt;

@interface Student : NSObject

@property (nonatomic, strong) NSString *name;
@property (nonatomic, assign) int age;
@property (nonatomic, assign) int idNumber;

@end


</code></pre></div></div>

<p>ä½¿ç”¨æˆ‘ä»¬çš„è½¬æ¨¡å‹æ–¹æ³•ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NSDictionary *dic = @{ @"name":@"é‚±å¸…", @"age": @(23), @"idNumber":@(1234567)};

Student *stu = [Student new];
[stu by_modelSetDictionary:dic];

NSLog(@"%@", [NSString stringWithFormat:@"%@, %d, %d", stu.name, stu.age, stu.idNumber]);

// è¾“å‡º
2016-11-24 15:32:46.351 Demo_å­—å…¸è½¬æ¨¡å‹ï¼ˆRuntimeï¼‰[2131:884627] é‚±å¸…, 23, 1234567
</code></pre></div></div>

<p>è¯¥æ–¹æ³•å…ˆåˆ©ç”¨æˆ‘ä»¬ä¸Šé¢ä»‹ç»çš„<code class="language-plaintext highlighter-rouge">class_copyIvarList()</code>è·å–ç±»ä¸­çš„æˆå‘˜å˜é‡åˆ—è¡¨ï¼Œç„¶åè¿›è¡Œéå†ï¼Œæ‹¼æ¥å­—ç¬¦ä¸²<code class="language-plaintext highlighter-rouge">setIvar:</code>ï¼Œæœ€åè°ƒç”¨<code class="language-plaintext highlighter-rouge">objc_msgSend()</code>ç›´æ¥å‘é€è®¾ç½®å˜é‡çš„æ¶ˆæ¯ï¼Œå®Œæˆå±æ€§çš„èµ‹å€¼ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>while (cls) {

	//code..
	
 cls = class_getSuperclass(cls);
}
</code></pre></div></div>
<p>è¿™ä¸ªå¾ªç¯æ˜¯åˆ™è·å–çˆ¶ç±»ä¸­çš„å±æ€§ï¼šå½“å‰ç±»çš„å±æ€§éå†ç»“æŸä¹‹åï¼ŒæŒ‡å‘çˆ¶ç±»ï¼Œè‹¥çˆ¶ç±»å­˜åœ¨åˆ™åœ¨ç»§ç»­éå†å±æ€§ï¼Œå¦åˆ™å°±é€€å‡ºå¾ªç¯ã€‚</p>

<p>å½“ç„¶ï¼Œè¿™ä¸ªæ–¹æ³•åªæ˜¯ä»‹ç»äº†åˆ©ç”¨runtimeè¿›è¡Œå­—å…¸è½¬æ¨¡å‹çš„åŸç†,å®é™…ä¸­è¿˜æœ‰å¾ˆå¤šéœ€è¦è€ƒè™‘çš„ç»†èŠ‚ï¼Œé¡¹ç›®ä¸­æˆ‘è¿˜æ˜¯æ¨èä½¿ç”¨åƒ<a href="https://github.com/ibireme/YYModel">YYModel</a>è¿™äº›æ¯”è¾ƒæˆç†Ÿè€Œä¸”å®‰å…¨çš„æ¨¡å‹æ¡†æ¶ã€‚</p>

<p>å…³äºå¿«é€Ÿå­—å…¸è½¬æ¨¡å‹å¯ä»¥å‚è€ƒæˆ‘å†™çš„ä¸€ç¯‡<a href="http://www.jianshu.com/p/b7d8cf650722">ã€Šå¿«é€Ÿå®ŒæˆJSON\å­—å…¸è½¬æ¨¡å‹ For YYModelã€‹</a>ã€‚</p>

:ET