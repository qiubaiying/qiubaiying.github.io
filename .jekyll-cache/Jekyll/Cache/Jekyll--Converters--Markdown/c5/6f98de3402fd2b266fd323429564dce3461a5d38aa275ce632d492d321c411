I"è°<p><img src="https://koenig-media.raywenderlich.com/uploads/2017/03/WhatsNewSwift3.1-feature-1-250x250.png" alt="" /></p>

<p>Xcode 8.3 å’Œ Swift 3.1 ç°åœ¨å·²ç»å‘å¸ƒäº†(3/28)ï¼</p>

<p>å¯ä»¥é€šè¿‡ <a href="https://itunes.apple.com/us/app/xcode/id497799835?ls=1&amp;mt=12#">AppStore</a> æˆ– <a href="https://developer.apple.com/download/more/">Apple Developer</a> è¿›è¡Œä¸‹è½½</p>

<p><img src="https://ww2.sinaimg.cn/large/006tNbRwgy1fe2it3xwt6j30s50g3mya.jpg" alt="" /></p>

<p>Xcode 8.3 ä¼˜åŒ–äº† Objective-C ä¸ Swift æ··ç¼–é¡¹ç›®çš„ç¼–è¯‘é€Ÿåº¦.</p>

<p>Swift 3.1 ç‰ˆæœ¬åŒ…å«ä¸€äº›æœŸå¾…å·²ä¹…çš„ <a href="https://github.com/apple/swift-package-manager">Swift package manager</a> åŠŸèƒ½å’Œè¯­æ³•æœ¬èº«çš„æ”¹è¿›ã€‚</p>

<p>å¦‚æœæ‚¨æ²¡æœ‰å¯†åˆ‡å…³æ³¨ <a href="https://github.com/apple/swift-evolution">Swift Evolution</a> è¿›ç¨‹ï¼Œè¯·ç»§ç»­é˜…è¯» - æœ¬æ–‡éå¸¸é€‚åˆæ‚¨ï¼</p>

<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†å¼ºè°ƒSwift 3.1ä¸­æœ€é‡è¦çš„å˜åŒ–ï¼Œè¿™å°†å¯¹æ‚¨çš„ä»£ç äº§ç”Ÿé‡å¤§å½±å“ã€‚æˆ‘ä»¬æ¥å§ï¼ğŸ˜ƒ</p>

<h2 id="å¼€å§‹">å¼€å§‹</h2>

<p>Swift 3.1ä¸Swift 3.0æºä»£ç å…¼å®¹ï¼Œå› æ­¤å¦‚æœæ‚¨å·²ç»ä½¿ç”¨Xcode ä¸­çš„ <code class="language-plaintext highlighter-rouge">Edit \ Convert \ To Current Swift Syntax ...</code> å°†é¡¹ç›®è¿ç§»åˆ°Swift 3.0ï¼Œæ–°åŠŸèƒ½å°†ä¸ä¼šç ´åæ‚¨çš„ä»£ç ã€‚ä¸è¿‡ï¼Œè‹¹æœå·²ç»åœ¨Xcode 8.3ä¸­æ”¯æŒSwift 2.3ã€‚æ‰€ä»¥å¦‚æœä½ è¿˜æ²¡æœ‰ä»Swift 2.3è¿ç§»ï¼Œç°åœ¨æ˜¯æ—¶å€™è¿™æ ·åšäº†ï¼</p>

<p>åœ¨ä¸‹é¢çš„éƒ¨åˆ†ï¼Œæ‚¨ä¼šçœ‹åˆ°é“¾æ¥çš„æ ‡ç­¾ï¼Œå¦‚<code class="language-plaintext highlighter-rouge">[SE-0001]</code>ã€‚è¿™äº›æ˜¯ <a href="https://apple.github.io/swift-evolution/">Swift Evolution</a> ææ¡ˆå·ç ã€‚æˆ‘å·²ç»åˆ—å‡ºäº†æ¯ä¸ªææ¡ˆçš„é“¾æ¥ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥å‘ç°æ¯ä¸ªç‰¹å®šæ›´æ”¹çš„å®Œæ•´è¯¦ç»†ä¿¡æ¯ã€‚æˆ‘å»ºè®®æ‚¨å°è¯•åœ¨Playgroundä¸ŠéªŒè¯æ–°çš„åŠŸèƒ½ï¼Œä»¥ä¾¿æ›´å¥½åœ°äº†è§£æ‰€æœ‰æ›´æ”¹çš„å†…å®¹ã€‚</p>

<blockquote>
  <p>Note:å¦‚æœä½ æƒ³äº†è§£ swift 3.0 ä¸­çš„æ–°åŠŸèƒ½ï¼Œå¯ä»¥çœ‹<a href="https://www.raywenderlich.com/135655/whats-new-swift-3">è¿™ç¯‡æ–‡ç« </a>ã€‚</p>
</blockquote>

<h2 id="è¯­æ³•æ”¹è¿›">è¯­æ³•æ”¹è¿›</h2>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªç‰ˆæœ¬ä¸­çš„è¯­æ³•æ”¹è¿›ï¼ŒåŒ…æ‹¬å…³äºæ•°å€¼ç±»å‹çš„<code class="language-plaintext highlighter-rouge">å¯å¤±è´¥æ„é€ å™¨</code>ï¼ˆ<code class="language-plaintext highlighter-rouge">Failable Initializers</code>ï¼‰ï¼Œæ–°çš„åºåˆ—å‡½æ•°ç­‰ç­‰ã€‚</p>

<h4 id="å¯å¤±è´¥çš„æ•°å€¼è½¬æ¢æ„é€ å™¨failable-numeric-conversion-initializers">å¯å¤±è´¥çš„æ•°å€¼è½¬æ¢æ„é€ å™¨ï¼ˆFailable Numeric Conversion Initializersï¼‰</h4>

<p>Swift 3.1 ä¸ºæ‰€æœ‰æ•°å€¼ç±»å‹ <code class="language-plaintext highlighter-rouge">(Int, Int8, Int16, Int32, Int64, UInt, UInt8, UInt16, UInt32, UInt64, Float, Float80, Double)</code> æ·»åŠ äº†<a href="https://www.swiftmi.com/topic/121.html">å¯å¤±è´¥æ„é€ å™¨</a>ã€‚</p>

<p>è¿™ä¸ªåŠŸèƒ½éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚ï¼Œä»¥å®‰å…¨ã€å¯æ¢å¤çš„æ–¹å¼å¤„ç†å¤–æºæ¾æ•£ç±»å‹æ•°æ®çš„è½¬æ¢ï¼Œä¸‹é¢æ¥çœ‹ Student çš„ JSON æ•°ç»„çš„å¤„ç†ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">Student</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
  <span class="k">let</span> <span class="nv">grade</span><span class="p">:</span> <span class="kt">Int</span>
 
  <span class="nf">init</span><span class="p">?(</span><span class="nv">json</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">])</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span><span class="p">,</span>
          <span class="k">let</span> <span class="nv">gradeString</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s">"grade"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span><span class="p">,</span>
          <span class="k">let</span> <span class="nv">gradeDouble</span> <span class="o">=</span> <span class="kt">Double</span><span class="p">(</span><span class="n">gradeString</span><span class="p">),</span>
          <span class="k">let</span> <span class="nv">grade</span> <span class="o">=</span> <span class="kt">Int</span><span class="p">(</span><span class="nv">exactly</span><span class="p">:</span> <span class="n">gradeDouble</span><span class="p">)</span>  <span class="c1">// &lt;-- 3.1 çš„æ”¹åŠ¨åœ¨è¿™</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
    <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">self</span><span class="o">.</span><span class="n">grade</span> <span class="o">=</span> <span class="n">grade</span>
  <span class="p">}</span>
<span class="p">}</span>
 
<span class="kd">func</span> <span class="nf">makeStudents</span><span class="p">(</span><span class="n">with</span> <span class="nv">data</span><span class="p">:</span> <span class="kt">Data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">Student</span><span class="p">]</span> <span class="p">{</span>
  <span class="k">guard</span> <span class="k">let</span> <span class="nv">json</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="nf">jsonObject</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="n">allowFragments</span><span class="p">),</span>
        <span class="k">let</span> <span class="nv">jsonArray</span> <span class="o">=</span> <span class="n">json</span> <span class="k">as?</span> <span class="p">[[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]]</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[]</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">jsonArray</span><span class="o">.</span><span class="nf">flatMap</span><span class="p">(</span><span class="kt">Student</span><span class="o">.</span><span class="kd">init</span><span class="p">)</span>
<span class="p">}</span>
 
<span class="k">let</span> <span class="nv">rawStudents</span> <span class="o">=</span> <span class="s">"[{</span><span class="se">\"</span><span class="s">name</span><span class="se">\"</span><span class="s">:</span><span class="se">\"</span><span class="s">Ray</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">grade</span><span class="se">\"</span><span class="s">:</span><span class="se">\"</span><span class="s">5.0</span><span class="se">\"</span><span class="s">}, {</span><span class="se">\"</span><span class="s">name</span><span class="se">\"</span><span class="s">:</span><span class="se">\"</span><span class="s">Matt</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">grade</span><span class="se">\"</span><span class="s">:</span><span class="se">\"</span><span class="s">6</span><span class="se">\"</span><span class="s">},
                    {</span><span class="se">\"</span><span class="s">name</span><span class="se">\"</span><span class="s">:</span><span class="se">\"</span><span class="s">Chris</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">grade</span><span class="se">\"</span><span class="s">:</span><span class="se">\"</span><span class="s">6.33</span><span class="se">\"</span><span class="s">}, {</span><span class="se">\"</span><span class="s">name</span><span class="se">\"</span><span class="s">:</span><span class="se">\"</span><span class="s">Cosmin</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">grade</span><span class="se">\"</span><span class="s">:</span><span class="se">\"</span><span class="s">7</span><span class="se">\"</span><span class="s">}, 
                    {</span><span class="se">\"</span><span class="s">name</span><span class="se">\"</span><span class="s">:</span><span class="se">\"</span><span class="s">Steven</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">grade</span><span class="se">\"</span><span class="s">:</span><span class="se">\"</span><span class="s">7.5</span><span class="se">\"</span><span class="s">}]"</span>
<span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">rawStudents</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span>
<span class="k">let</span> <span class="nv">students</span> <span class="o">=</span> <span class="nf">makeStudents</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">data</span><span class="p">)</span>
<span class="nf">dump</span><span class="p">(</span><span class="n">students</span><span class="p">)</span> <span class="c1">// [(name: "Ray", grade: 5), (name: "Matt", grade: 6), (name: "Cosmin", grade: 7)]</span>
</code></pre></div></div>
<p>åœ¨ <code class="language-plaintext highlighter-rouge">Student</code> ç±»ä¸­ä½¿ç”¨äº†ä¸€ä¸ªå¯å¤±è´¥æ„é€ å™¨å°† <code class="language-plaintext highlighter-rouge">grade</code> å±æ€§ä» <code class="language-plaintext highlighter-rouge">Double </code> è½¬å˜ä¸º <code class="language-plaintext highlighter-rouge">Int</code>ï¼Œåƒè¿™æ ·</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">grade</span> <span class="o">=</span> <span class="kt">Int</span><span class="p">(</span><span class="nv">exactly</span><span class="p">:</span> <span class="n">gradeDouble</span><span class="p">)</span>
</code></pre></div></div>

<p>å¦‚æœ<code class="language-plaintext highlighter-rouge">gradeDouble</code>ä¸æ˜¯æ•´æ•°ï¼Œä¾‹å¦‚6.33ï¼Œå®ƒå°†å¤±è´¥ã€‚å¦‚æœå®ƒå¯ä»¥ç”¨ä¸€ä¸ªæ­£ç¡®çš„è¡¨ç¤ºIntï¼Œä¾‹å¦‚6.0ï¼Œå®ƒå°†æˆåŠŸã€‚</p>

<blockquote>
  <p>Noteï¼šè™½ç„¶<code class="language-plaintext highlighter-rouge">throwing initializers</code> å¯ä»¥ç”¨æ¥æ›¿ä»£ <code class="language-plaintext highlighter-rouge">failable initializers</code>ã€‚ä½†æ˜¯ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">failable initializers</code> ä¼šæ›´å¥½ï¼Œæ›´ç¬¦åˆäººçš„æ€ç»´ã€‚</p>
</blockquote>

<h5 id="æ–°çš„åºåˆ—å‡½æ•°sequence-functions">æ–°çš„åºåˆ—å‡½æ•°ï¼ˆSequence Functionsï¼‰</h5>

<p>swift3.1æ·»åŠ äº†ä¸¤ä¸ªæ–°çš„æ ‡å‡†åº“å‡½æ•°åœ¨ <code class="language-plaintext highlighter-rouge">Sequence</code> åè®®ä¸­ï¼š<code class="language-plaintext highlighter-rouge">prefix(while:)</code><code class="language-plaintext highlighter-rouge">å’Œprefix(while:)</code><a href="https://github.com/apple/swift-evolution/blob/master/proposals/0045-scan-takewhile-dropwhile.md">[SE-0045]</a>ã€‚</p>

<p>æ„é€ ä¸€ä¸ª<a href="https://en.wikipedia.org/wiki/Fibonacci_number">æ–æ³¢çº³å¥‘</a>æ— é™åºåˆ—ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">fibonacci</span> <span class="o">=</span> <span class="nf">sequence</span><span class="p">(</span><span class="nv">state</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
  <span class="p">(</span><span class="nv">state</span><span class="p">:</span> <span class="nf">inout</span> <span class="p">(</span><span class="kt">Int</span><span class="p">,</span> <span class="kt">Int</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="kt">Int</span><span class="p">?</span> <span class="k">in</span>
  <span class="k">defer</span> <span class="p">{</span><span class="n">state</span> <span class="o">=</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="mi">0</span> <span class="o">+</span> <span class="n">state</span><span class="o">.</span><span class="mi">1</span><span class="p">)}</span>
  <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="mi">0</span>
<span class="p">}</span>
</code></pre></div></div>

<p>åœ¨Swift 3.0ä¸­ï¼Œæ‚¨åªéœ€æŒ‡å®š<code class="language-plaintext highlighter-rouge">è¿­ä»£æ¬¡æ•°</code>å³å¯éå†fibonacciåºåˆ—ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Swift 3.0</span>
<span class="k">for</span> <span class="n">number</span> <span class="k">in</span> <span class="n">fibonacci</span><span class="o">.</span><span class="nf">prefix</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>  <span class="c1">// 0 1 1 2 3 5 8 13 21 34</span>
<span class="p">}</span>
</code></pre></div></div>

<p>åœ¨swift 3.1ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">prefix(while:)</code>å’Œ<code class="language-plaintext highlighter-rouge">drop(while:)</code>è·å¾—ç¬¦åˆæ¡ä»¶åœ¨ä¸¤ä¸ªç»™å®šå€¼ä¹‹é—´çš„åºåˆ—ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå°±åƒè¿™æ ·ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Swift 3.1</span>
<span class="k">let</span> <span class="nv">interval</span> <span class="o">=</span> <span class="n">fibonacci</span><span class="o">.</span><span class="nf">prefix</span><span class="p">(</span><span class="nv">while</span><span class="p">:</span> <span class="p">{</span><span class="nv">$0</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">})</span><span class="o">.</span><span class="nf">drop</span><span class="p">(</span><span class="nv">while</span><span class="p">:</span> <span class="p">{</span><span class="nv">$0</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">})</span>
<span class="k">for</span> <span class="n">element</span> <span class="k">in</span> <span class="n">interval</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="c1">// 144 233 377 610 987</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">prefix(while:)</code>è¿”å›æ»¡è¶³æŸä¸ªè°“è¯çš„æœ€é•¿å­åºåˆ—ã€‚å®ƒä»åºåˆ—çš„å¼€å¤´å¼€å§‹ï¼Œå¹¶åœåœ¨ç»™å®šé—­åŒ…è¿”å›falseçš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸Šã€‚</p>

<p><code class="language-plaintext highlighter-rouge">drop(while:)</code> ç›¸åï¼šå®ƒè¿”å›ä»ç»™å®šå…³é—­è¿”å›falseçš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹çš„å­åºåˆ—ï¼Œå¹¶åœ¨åºåˆ—ç»“å°¾å®Œæˆã€‚</p>

<blockquote>
  <p>Note:è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨å°¾éšé—­åŒ…çš„å†™æ³•ï¼š</p>

  <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">interval</span> <span class="o">=</span> <span class="n">fibonacci</span><span class="o">.</span><span class="k">prefix</span><span class="p">{</span><span class="nv">$0</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">}</span><span class="o">.</span><span class="n">drop</span><span class="p">{</span><span class="nv">$0</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">}</span>
</code></pre></div>  </div>
</blockquote>

<h2 id="concrete-constrained-extensionså§‘ä¸”ç¿»è¯‘ä¸ºç±»çš„çº¦æŸæ‰©å±•å§">Concrete Constrained Extensionsï¼ˆå§‘ä¸”ç¿»è¯‘ä¸ºç±»çš„çº¦æŸæ‰©å±•å§ï¼‰</h2>

<p>Swift 3.1å…è®¸æ‚¨æ‰©å±•å…·æœ‰ç±»å‹çº¦æŸçš„é€šç”¨ç±»å‹ã€‚ä»¥å‰ï¼Œä½ ä¸èƒ½åƒè¿™æ ·æ‰©å±•ç±»å‹ï¼Œå› ä¸ºçº¦æŸå¿…é¡»æ˜¯ä¸€ä¸ªåè®®ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚</p>

<p>ä¾‹å¦‚ï¼ŒRuby on Railsæä¾›äº†ä¸€ç§<code class="language-plaintext highlighter-rouge">isBlank</code>æ£€æŸ¥ç”¨æˆ·è¾“å…¥çš„éå¸¸æœ‰ç”¨çš„æ–¹æ³•ã€‚ä»¥ä¸‹æ˜¯åœ¨Swift 3.0ä¸­ç”¨ <code class="language-plaintext highlighter-rouge">String</code> ç±»å‹çš„æ‰©å±•å®ç°è¿™ä¸ª<strong>è®¡ç®—å‹å±æ€§</strong>ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Swift 3.0</span>
<span class="kd">extension</span> <span class="kt">String</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">isBlank</span><span class="p">:</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nf">trimmingCharacters</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="n">whitespaces</span><span class="p">)</span><span class="o">.</span><span class="n">isEmpty</span>
  <span class="p">}</span>
<span class="p">}</span>
 
<span class="k">let</span> <span class="nv">abc</span> <span class="o">=</span> <span class="s">" "</span>
<span class="k">let</span> <span class="nv">def</span> <span class="o">=</span> <span class="s">"x"</span>
 
<span class="n">abc</span><span class="o">.</span><span class="n">isBlank</span> <span class="c1">// true</span>
<span class="n">def</span><span class="o">.</span><span class="n">isBlank</span> <span class="c1">// false</span>
</code></pre></div></div>

<p>å¦‚æœä½ å¸Œæœ›<code class="language-plaintext highlighter-rouge">isBlank</code>è®¡ç®—å‹å±æ€§ä¸ºä¸€ä¸ªå¯é€‰å€¼æ‰€ç”¨ï¼Œåœ¨swift 3.0ä¸­ï¼Œä½ å°†è¦è¿™æ ·åš</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Swift 3.0</span>
<span class="kd">protocol</span> <span class="kt">StringProvider</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">string</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span><span class="k">get</span><span class="p">}</span>
<span class="p">}</span>
 
<span class="kd">extension</span> <span class="kt">String</span><span class="p">:</span> <span class="kt">StringProvider</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">string</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">self</span>
  <span class="p">}</span>
<span class="p">}</span>
 
<span class="kd">extension</span> <span class="kt">Optional</span> <span class="k">where</span> <span class="kt">Wrapped</span><span class="p">:</span> <span class="kt">StringProvider</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">isBlank</span><span class="p">:</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">self</span><span class="p">?</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">isBlank</span> <span class="p">??</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
 
<span class="k">let</span> <span class="nv">foo</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
<span class="k">let</span> <span class="nv">bar</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span> <span class="o">=</span> <span class="s">"  "</span>
<span class="k">let</span> <span class="nv">baz</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span> <span class="o">=</span> <span class="s">"x"</span>
 
<span class="n">foo</span><span class="o">.</span><span class="n">isBlank</span> <span class="c1">// true</span>
<span class="n">bar</span><span class="o">.</span><span class="n">isBlank</span> <span class="c1">// true</span>
<span class="n">baz</span><span class="o">.</span><span class="n">isBlank</span> <span class="c1">// false</span>
</code></pre></div></div>

<p>è¿™åˆ›å»ºäº†ä¸€ä¸ªé‡‡ç”¨ <code class="language-plaintext highlighter-rouge">String</code> çš„ <code class="language-plaintext highlighter-rouge">StringProvider</code> åè®®è€Œåœ¨ä½ ä½¿ç”¨StringProvideræ‰©å±•å¯é€‰çš„ wrapped ç±»å‹æ—¶,æ·»åŠ isBlankæ–¹æ³•ã€‚</p>

<p>Swift 3.1ä¸­ï¼Œç”¨æ¥æ›¿ä»£åè®®æ–¹æ³•ï¼Œæ‰©å±•å…·ä½“ç±»å‹çš„æ–¹æ³•åƒè¿™æ ·ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Swift 3.1</span>
<span class="kd">extension</span> <span class="kt">Optional</span> <span class="k">where</span> <span class="kt">Wrapped</span> <span class="o">==</span> <span class="kt">String</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">isBlank</span><span class="p">:</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">self</span><span class="p">?</span><span class="o">.</span><span class="n">isBlank</span> <span class="p">??</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>è¿™å°±ç”¨æ›´å°‘çš„ä»£ç å®ç°äº†å’ŒåŸå…ˆç›¸åŒçš„åŠŸèƒ½~</p>

<h2 id="æ³›å‹åµŒå¥—nested-generics">æ³›å‹åµŒå¥—ï¼ˆNested Genericsï¼‰</h2>

<p>Swift 3.1å…è®¸æ‚¨å°†åµŒå¥—ç±»å‹ä¸æ³›å‹æ··åˆã€‚ä½œä¸ºä¸€ä¸ªç»ƒä¹ ï¼Œè€ƒè™‘è¿™ä¸ªï¼ˆä¸æ˜¯å¤ªç–¯ç‹‚ï¼‰çš„ä¾‹å­ã€‚æ¯å½“æŸä¸ªå›¢é˜Ÿé¢†å¯¼raywenderlich.comæƒ³åœ¨åšå®¢ä¸Šå‘å¸ƒä¸€ç¯‡æ–‡ç« æ—¶ï¼Œä»–ä¼šåˆ†é…ä¸€æ‰¹ä¸“é—¨çš„å¼€å‘äººå‘˜æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œä»¥æ»¡è¶³ç½‘ç«™çš„é«˜è´¨é‡æ ‡å‡†ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">Team</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="kd">enum</span> <span class="kt">TeamType</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">swift</span>
    <span class="k">case</span> <span class="n">iOS</span>
    <span class="k">case</span> <span class="n">macOS</span>
  <span class="p">}</span>
 
  <span class="kd">class</span> <span class="kt">BlogPost</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="kt">BlogPostType</span> <span class="p">{</span>
      <span class="k">case</span> <span class="n">tutorial</span>
      <span class="k">case</span> <span class="n">article</span>
    <span class="p">}</span>
 
    <span class="k">let</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">T</span>
    <span class="k">let</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">BlogPostType</span>
    <span class="k">let</span> <span class="nv">category</span><span class="p">:</span> <span class="kt">TeamType</span>
    <span class="k">let</span> <span class="nv">publishDate</span><span class="p">:</span> <span class="kt">Date</span>
 
    <span class="nf">init</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="kt">T</span><span class="p">,</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">BlogPostType</span><span class="p">,</span> <span class="nv">category</span><span class="p">:</span> <span class="kt">TeamType</span><span class="p">,</span> <span class="nv">publishDate</span><span class="p">:</span> <span class="kt">Date</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
      <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">type</span>
      <span class="k">self</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
      <span class="k">self</span><span class="o">.</span><span class="n">publishDate</span> <span class="o">=</span> <span class="n">publishDate</span>
    <span class="p">}</span>
  <span class="p">}</span>
 
  <span class="k">let</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">TeamType</span>
  <span class="k">let</span> <span class="nv">author</span><span class="p">:</span> <span class="kt">T</span>
  <span class="k">let</span> <span class="nv">teamLead</span><span class="p">:</span> <span class="kt">T</span>
  <span class="k">let</span> <span class="nv">blogPost</span><span class="p">:</span> <span class="kt">BlogPost</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span>
 
  <span class="nf">init</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">TeamType</span><span class="p">,</span> <span class="nv">author</span><span class="p">:</span> <span class="kt">T</span><span class="p">,</span> <span class="nv">teamLead</span><span class="p">:</span> <span class="kt">T</span><span class="p">,</span> <span class="nv">blogPost</span><span class="p">:</span> <span class="kt">BlogPost</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">type</span>
    <span class="k">self</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
    <span class="k">self</span><span class="o">.</span><span class="n">teamLead</span> <span class="o">=</span> <span class="n">teamLead</span>
    <span class="k">self</span><span class="o">.</span><span class="n">blogPost</span> <span class="o">=</span> <span class="n">blogPost</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å°†<code class="language-plaintext highlighter-rouge">BlogPost</code>å†…éƒ¨ç±»åµŒå¥—åœ¨å…¶å¯¹åº”çš„<code class="language-plaintext highlighter-rouge">Team</code>å¤–éƒ¨ç±»ä¸­ï¼Œå¹¶ä½¿ä¸¤ä¸ªç±»éƒ½é€šç”¨ã€‚è¿™æ˜¯å›¢é˜Ÿå¦‚ä½•å¯»æ‰¾æˆ‘åœ¨ç½‘ç«™ä¸Šå‘å¸ƒçš„æ•™ç¨‹å’Œæ–‡ç« ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">Team</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="o">.</span><span class="n">swift</span><span class="p">,</span> <span class="nv">author</span><span class="p">:</span> <span class="s">"Cosmin PupÄƒzÄƒ"</span><span class="p">,</span> <span class="nv">teamLead</span><span class="p">:</span> <span class="s">"Ray Fix"</span><span class="p">,</span> 
     <span class="nv">blogPost</span><span class="p">:</span> <span class="kt">Team</span><span class="o">.</span><span class="kt">BlogPost</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"Pattern Matching"</span><span class="p">,</span> <span class="nv">type</span><span class="p">:</span> <span class="o">.</span><span class="n">tutorial</span><span class="p">,</span> 
     <span class="nv">category</span><span class="p">:</span> <span class="o">.</span><span class="n">swift</span><span class="p">,</span> <span class="nv">publishDate</span><span class="p">:</span> <span class="kt">Date</span><span class="p">()))</span>
 
<span class="kt">Team</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="o">.</span><span class="n">swift</span><span class="p">,</span> <span class="nv">author</span><span class="p">:</span> <span class="s">"Cosmin PupÄƒzÄƒ"</span><span class="p">,</span> <span class="nv">teamLead</span><span class="p">:</span> <span class="s">"Ray Fix"</span><span class="p">,</span> 
     <span class="nv">blogPost</span><span class="p">:</span> <span class="kt">Team</span><span class="o">.</span><span class="kt">BlogPost</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"What's New in Swift 3.1?"</span><span class="p">,</span> <span class="nv">type</span><span class="p">:</span> <span class="o">.</span><span class="n">article</span><span class="p">,</span> 
     <span class="nv">category</span><span class="p">:</span> <span class="o">.</span><span class="n">swift</span><span class="p">,</span> <span class="nv">publishDate</span><span class="p">:</span> <span class="kt">Date</span><span class="p">()))</span>
</code></pre></div></div>

<p>ä½†å®é™…ä¸Šï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ç®€åŒ–è¯¥ä»£ç ã€‚å¦‚æœåµŒå¥—çš„å†…éƒ¨ç±»å‹ä½¿ç”¨é€šç”¨å¤–éƒ¨ç±»å‹ï¼Œé‚£ä¹ˆå®ƒé»˜è®¤ç»§æ‰¿çˆ¶ç±»çš„ç±»å‹ã€‚å› æ­¤ï¼Œæ‚¨ä¸éœ€è¦å¦‚æ­¤å£°æ˜ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">Team</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="c1">// original code </span>
 
  <span class="kd">class</span> <span class="kt">BlogPost</span> <span class="p">{</span>
    <span class="c1">// original code</span>
  <span class="p">}</span>  
 
  <span class="c1">// original code </span>
  <span class="k">let</span> <span class="nv">blogPost</span><span class="p">:</span> <span class="kt">BlogPost</span>
 
  <span class="nf">init</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">TeamType</span><span class="p">,</span> <span class="nv">author</span><span class="p">:</span> <span class="kt">T</span><span class="p">,</span> <span class="nv">teamLead</span><span class="p">:</span> <span class="kt">T</span><span class="p">,</span> <span class="nv">blogPost</span><span class="p">:</span> <span class="kt">BlogPost</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// original code   </span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>Noteï¼šå¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äºSwiftä¸­çš„<strong>æ³›å‹</strong>ï¼Œè¯·é˜…è¯»æˆ‘ä»¬æœ€è¿‘æ›´æ–°çš„<a href="https://www.raywenderlich.com/154371/swift-generics-tutorial-getting-started">Swiftæ³›å‹å…¥é—¨çš„æ•™ç¨‹</a>ã€‚</p>
</blockquote>

<h2 id="swiftç‰ˆæœ¬çš„å¯ç”¨æ€§">Swiftç‰ˆæœ¬çš„å¯ç”¨æ€§</h2>

<p>æ‚¨å¯ä»¥ä½¿ç”¨<strong>#if swift(&gt;= N)</strong> <code class="language-plaintext highlighter-rouge">é™æ€æ„é€ </code>æ¥æ£€æŸ¥ç‰¹å®šçš„Swiftç‰ˆæœ¬ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Swift 3.0</span>
<span class="cp">#if swift(&gt;=3.1)</span>
  <span class="kd">func</span> <span class="nf">intVersion</span><span class="p">(</span><span class="nv">number</span><span class="p">:</span> <span class="kt">Double</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span><span class="p">?</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kt">Int</span><span class="p">(</span><span class="nv">exactly</span><span class="p">:</span> <span class="n">number</span><span class="p">)</span>
  <span class="p">}</span>
<span class="cp">#elseif swift(&gt;=3.0)</span>
  <span class="kd">func</span> <span class="nf">intVersion</span><span class="p">(</span><span class="nv">number</span><span class="p">:</span> <span class="kt">Double</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kt">Int</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
  <span class="p">}</span>
<span class="cp">#endif</span>
</code></pre></div></div>

<p>ç„¶è€Œï¼Œå½“ä½¿ç”¨Swiftæ ‡å‡†åº“æ—¶ï¼Œè¿™ç§æ–¹æ³•æœ‰ä¸€ä¸ªä¸»è¦ç¼ºç‚¹ã€‚å®ƒéœ€è¦ä¸ºæ¯ä¸ªå—æ”¯æŒçš„æ—§è¯­è¨€ç‰ˆæœ¬ç¼–è¯‘æ ‡å‡†åº“ã€‚è¿™æ˜¯å› ä¸ºå½“æ‚¨ä»¥å‘åå…¼å®¹æ¨¡å¼è¿è¡ŒSwiftç¼–è¯‘å™¨æ—¶ï¼Œä¾‹å¦‚æ‚¨è¦ä½¿ç”¨Swift 3.0è¡Œä¸ºï¼Œåˆ™éœ€è¦ä½¿ç”¨é’ˆå¯¹è¯¥ç‰¹å®šå…¼å®¹æ€§ç‰ˆæœ¬ç¼–è¯‘çš„æ ‡å‡†åº“ç‰ˆæœ¬ã€‚å¦‚æœæ‚¨ä½¿ç”¨ç‰ˆæœ¬3.1æ¨¡å¼ç¼–è¯‘çš„ï¼Œé‚£ä¹ˆæ‚¨æ ¹æœ¬å°±æ²¡æœ‰æ­£ç¡®çš„ä»£ç </p>

<p>å› æ­¤ï¼Œ@availableé™¤äº†ç°æœ‰å¹³å°ç‰ˆæœ¬ <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0141-available-by-swift-version.md">[SE-0141]</a> ä¹‹å¤–ï¼ŒSwift 3.1æ‰©å±•äº†è¯¥å±æ€§ä»¥æ”¯æŒæŒ‡å®šSwiftç‰ˆæœ¬å·ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Swift 3.1</span>
 
<span class="kd">@available</span><span class="p">(</span><span class="n">swift</span> <span class="mf">3.1</span><span class="p">)</span>
<span class="kd">func</span> <span class="nf">intVersion</span><span class="p">(</span><span class="nv">number</span><span class="p">:</span> <span class="kt">Double</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span><span class="p">?</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kt">Int</span><span class="p">(</span><span class="nv">exactly</span><span class="p">:</span> <span class="n">number</span><span class="p">)</span>
<span class="p">}</span>
 
<span class="kd">@available</span><span class="p">(</span><span class="n">swift</span><span class="p">,</span> <span class="nv">introduced</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span> <span class="nv">obsoleted</span><span class="p">:</span> <span class="mf">3.1</span><span class="p">)</span>
<span class="kd">func</span> <span class="nf">intVersion</span><span class="p">(</span><span class="nv">number</span><span class="p">:</span> <span class="kt">Double</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kt">Int</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è¿™ä¸ªæ–°åŠŸèƒ½æä¾›äº†ä¸<code class="language-plaintext highlighter-rouge">intVersionSwift</code>ç‰ˆæœ¬æœ‰å…³çš„æ–¹æ³•ç›¸åŒçš„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œå®ƒåªå…è®¸åƒæ ‡å‡†åº“è¿™æ ·çš„åº“è¢«ç¼–è¯‘ä¸€æ¬¡ã€‚ç¼–è¯‘å™¨ç„¶åç®€å•åœ°é€‰æ‹©å¯ç”¨äºæ‰€é€‰æ‹©çš„ç»™å®šå…¼å®¹æ€§ç‰ˆæœ¬çš„åŠŸèƒ½ã€‚</p>

<blockquote>
  <p>Noteï¼šæ³¨æ„ï¼šå¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äºSwift çš„<code class="language-plaintext highlighter-rouge">å¯ç”¨æ€§å±æ€§ï¼ˆ availability attributesï¼‰</code>ï¼Œè¯·å‚é˜…æˆ‘ä»¬å…³äº<a href="https://www.raywenderlich.com/139077/availability-attributes-swift">Swiftä¸­å¯ç”¨æ€§å±æ€§çš„æ•™ç¨‹</a>ã€‚</p>
</blockquote>

<h2 id="é€ƒé€¸é—­åŒ…escaping-closures">é€ƒé€¸é—­åŒ…ï¼ˆEscaping Closuresï¼‰</h2>

<p>åœ¨Swift 3.0 <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0103-make-noescape-default.md">[ SE-0103 ]</a> ä¸­å‡½æ•°ä¸­çš„é—­åŒ…çš„å‚æ•°æ˜¯é»˜è®¤æ˜¯ä¸é€ƒé€¸çš„ï¼ˆnon-escapingï¼‰ã€‚åœ¨Swift 3.1ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ–°çš„å‡½æ•°<code class="language-plaintext highlighter-rouge">withoutActuallyEscaping()</code>å°†éé€ƒé€¸é—­åŒ…è½¬æ¢ä¸ºä¸´æ—¶é€ƒé€¸ã€‚</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">perform</span><span class="p">(</span><span class="n">_</span> <span class="nv">f</span><span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">,</span> <span class="n">simultaneouslyWith</span> <span class="nv">g</span><span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">,</span>
             <span class="n">on</span> <span class="nv">queue</span><span class="p">:</span> <span class="kt">DispatchQueue</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">withoutActuallyEscaping</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="p">{</span> <span class="n">escapableF</span> <span class="k">in</span>     <span class="c1">// 1</span>
    <span class="nf">withoutActuallyEscaping</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="p">{</span> <span class="n">escapableG</span> <span class="k">in</span>
      <span class="n">queue</span><span class="o">.</span><span class="nf">async</span><span class="p">(</span><span class="nv">execute</span><span class="p">:</span> <span class="n">escapableF</span><span class="p">)</span>           <span class="c1">// 2</span>
      <span class="n">queue</span><span class="o">.</span><span class="nf">async</span><span class="p">(</span><span class="nv">execute</span><span class="p">:</span> <span class="n">escapableG</span><span class="p">)</span>     
 
      <span class="n">queue</span><span class="o">.</span><span class="nf">sync</span><span class="p">(</span><span class="nv">flags</span><span class="p">:</span> <span class="o">.</span><span class="n">barrier</span><span class="p">)</span> <span class="p">{}</span>             <span class="c1">// 3</span>
    <span class="p">}</span>                                            <span class="c1">// 4</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æ­¤å‡½æ•°åŒæ—¶åŠ è½½ä¸¤ä¸ªé—­åŒ…ï¼Œç„¶ååœ¨ä¸¤ä¸ªå®Œæˆä¹‹åè¿”å›ã€‚</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">f</code> ä¸ <code class="language-plaintext highlighter-rouge">g</code> è¿›å…¥å‡½æ•°åç”±éé€ƒé€¸çŠ¶æ€ï¼Œåˆ†åˆ«è½¬æ¢ä¸ºé€ƒé€¸é—­åŒ…:<code class="language-plaintext highlighter-rouge">escapableF</code>å’Œ<code class="language-plaintext highlighter-rouge">escapableG</code>ã€‚</li>
  <li>async(execute:) çš„è°ƒç”¨éœ€è¦é€ƒé€¸é—­åŒ…ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢å·²ç»è¿›è¡Œäº†è½¬æ¢ã€‚</li>
  <li>é€šè¿‡è¿è¡Œ<code class="language-plaintext highlighter-rouge">sync(flags: .barrier)</code>ï¼Œæ‚¨ç¡®ä¿<code class="language-plaintext highlighter-rouge">async(execute:)</code>æ–¹æ³•å®Œå…¨å®Œæˆï¼Œç¨åå°†ä¸ä¼šè°ƒç”¨é—­åŒ…ã€‚</li>
  <li>åœ¨èŒƒå›´å†…ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">escapableF</code> and <code class="language-plaintext highlighter-rouge">escapableG</code>.</li>
</ol>

<p>å¦‚æœä½ å­˜å‚¨ä¸´æ—¶é€ƒç¦»é—­åŒ…(å³çœŸæ­£é€ƒè„±)è¿™å°†æ˜¯ä¸€ä¸ªBugã€‚æœªæ¥ç‰ˆæœ¬çš„æ ‡å‡†åº“å¯ä»¥æ£€æµ‹è¿™ä¸ªé™·é˜±,å¦‚æœä½ è¯•å›¾è°ƒç”¨å®ƒä»¬ã€‚</p>

<h2 id="swift-package-manager-æ›´æ–°">Swift Package Manager æ›´æ–°</h2>

<p>å•Šï¼ŒæœŸå¾…å·²ä¹…çš„ <strong>Swift Package Manage</strong> çš„æ›´æ–°äº†ï¼</p>

<h4 id="å¯ç¼–è¾‘è½¯ä»¶åŒ…editable-packages">å¯ç¼–è¾‘è½¯ä»¶åŒ…ï¼ˆEditable Packagesï¼‰</h4>

<p>Swift 3.1å°†<code class="language-plaintext highlighter-rouge">å¯ç¼–è¾‘è½¯ä»¶åŒ…(editable packages)</code>çš„æ¦‚å¿µæ·»åŠ åˆ°Swiftè½¯ä»¶åŒ…ç®¡ç†å™¨ <a href="https://github.com/apple/swift-package-manager/blob/master/Documentation/Usage.md#editable-packages">[ SE-0082 ]</a>ã€‚</p>

<p>è¯¥<code class="language-plaintext highlighter-rouge">swift package edit</code>å‘½ä»¤ä½¿ç”¨ç°æœ‰çš„<code class="language-plaintext highlighter-rouge">Packages</code>å¹¶å°†å…¶è½¬æ¢ä¸º<code class="language-plaintext highlighter-rouge">editable Packages</code>ã€‚ä½¿ç”¨<code class="language-plaintext highlighter-rouge">--end-edit</code>å‘½ä»¤å°† <code class="language-plaintext highlighter-rouge">package manager</code> è¿˜åŸå› <strong>è§„èŒƒè§£æçš„è½¯ä»¶åŒ…ï¼ˆcanonical resolved packagï¼‰</strong>ã€‚</p>

<h4 id="ç‰ˆæœ¬å›ºå®šversion-pinning">ç‰ˆæœ¬å›ºå®šï¼ˆVersion Pinningï¼‰</h4>

<p>Swift 3.1 æ·»åŠ äº†ç‰ˆæœ¬å›ºå®šçš„æ¦‚å¿µ[ SE-0145 ]ã€‚è¯¥ <code class="language-plaintext highlighter-rouge">pin</code> å‘½ä»¤ å›ºå®šä¸€ä¸ªæˆ–æ‰€æœ‰ä¾èµ–å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">swift</span> <span class="n">package</span> <span class="n">pin</span> <span class="o">--</span><span class="n">all</span>      <span class="c1">// å›ºå®šæ‰€æœ‰çš„ä¾èµ–</span>
<span class="err">$</span> <span class="n">swift</span> <span class="n">package</span> <span class="n">pin</span> <span class="kt">Foo</span>        <span class="c1">// å›ºå®š Foo åœ¨å½“å‰çš„é—­åŒ…</span>
<span class="err">$</span> <span class="n">swift</span> <span class="n">package</span> <span class="n">pin</span> <span class="kt">Foo</span> <span class="o">--</span><span class="n">version</span> <span class="mf">1.2</span><span class="o">.</span><span class="mi">3</span>  <span class="c1">// å›ºå®š Foo åœ¨ 1.2.3 ç‰ˆæœ¬</span>

</code></pre></div></div>

<p>ä½¿ç”¨<code class="language-plaintext highlighter-rouge">unpin</code>å‘½ä»¤æ¢å¤åˆ°ä»¥å‰çš„åŒ…ç‰ˆæœ¬ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">swift</span> <span class="n">package</span> <span class="n">unpin</span> <span class="err">â€”</span><span class="n">all</span>
<span class="err">$</span> <span class="n">swift</span> <span class="n">package</span> <span class="n">unpin</span> <span class="kt">Foo</span>
</code></pre></div></div>

<p>Package manager å°†æ¯ä¸ªä¾èµ–åº“çš„ç‰ˆæœ¬å›ºå®šä¿¡æ¯å­˜å‚¨åœ¨ <code class="language-plaintext highlighter-rouge">Package.pins</code> æ–‡ä»¶ä¸­ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™Package manager ä¼šè‡ªåŠ¨åˆ›å»ºã€‚</p>

<h4 id="å…¶ä»–">å…¶ä»–</h4>

<p><code class="language-plaintext highlighter-rouge">swift package reset</code> å‘½ä»¤å°†ä¼šæŠŠ Package é‡ç½®å¹²å‡€ã€‚</p>

<p><code class="language-plaintext highlighter-rouge">swift test --parallel</code> å‘½ä»¤ æ‰§è¡Œæµ‹è¯•ã€‚</p>

<h2 id="å…¶ä»–æ”¹åŠ¨">å…¶ä»–æ”¹åŠ¨</h2>

<p>åœ¨ swift 3.1 ä¸­è¿˜æœ‰ä¸€äº›å°æ”¹åŠ¨</p>

<h4 id="å¤šé‡è¿”å›å‡½æ•°">å¤šé‡è¿”å›å‡½æ•°</h4>
<p>Cå‡½æ•°è¿”å›ä¸¤æ¬¡ï¼Œä¾‹å¦‚<code class="language-plaintext highlighter-rouge">vfork</code> å’Œ <code class="language-plaintext highlighter-rouge">vfork </code>å·²ç»ä¸ç”¨äº†ã€‚ä»–ä»¬ä»¥æœ‰è¶£çš„æ–¹å¼æ”¹å˜äº†ç¨‹åºçš„æ§åˆ¶æµç¨‹ã€‚æ‰€ä»¥ Swift ç¤¾åŒº å·²ç»ç¦æ­¢äº†è¯¥è¡Œä¸ºï¼Œä»¥å…å¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚</p>

<h4 id="è‡ªåŠ¨é“¾æ¥å¤±æ•ˆdisable-auto-linking">è‡ªåŠ¨é“¾æ¥å¤±æ•ˆï¼ˆDisable Auto-Linkingï¼‰</h4>

<p><a href="https://github.com/apple/swift-package-manager">Swift Package Manager</a> ç¦ç”¨äº†åœ¨Cè¯­è¨€ <a href="http://nsomar.com/modular-framework-creating-and-using-them/"><strong>æ¨¡å—æ˜ å°„ï¼ˆmodule mapsï¼‰</strong></a>ä¸­çš„<strong>è‡ªåŠ¨é“¾æ¥</strong>çš„åŠŸèƒ½ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Swift 3.0</span>
<span class="n">module</span> <span class="kt">MyCLib</span> <span class="p">{</span>
    <span class="n">header</span> <span class="err">â€œ</span><span class="n">foo</span><span class="o">.</span><span class="n">h</span><span class="s">"
    link â€œMyCLib"</span>
    <span class="n">export</span> <span class="o">*</span>
<span class="p">}</span>
 
<span class="c1">// Swift 3.1</span>
<span class="n">module</span> <span class="kt">MyCLib</span> <span class="p">{</span>
    <span class="n">header</span> <span class="err">â€œ</span><span class="n">foo</span><span class="o">.</span><span class="n">h</span><span class="err">â€</span>
    <span class="n">export</span> <span class="o">*</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="ç»“è¯­">ç»“è¯­</h2>

<p>Swift 3.1æ”¹å–„äº†Swift 3.0çš„ä¸€äº›åŠŸèƒ½ï¼Œä¸ºå³å°†åˆ°æ¥çš„Swift 4.0çš„å¤§æ”¹åŠ¨åšå‡†å¤‡ã€‚è¿™äº›åŒ…æ‹¬å¯¹æ³›å‹ï¼Œæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ›´ç§‘å­¦çš„<code class="language-plaintext highlighter-rouge">String</code>ç­‰æ–¹é¢çš„ä½œå‡ºæå¤§çš„æ”¹è¿›ã€‚</p>

<p>å¦‚æœä½ æƒ³äº†è§£æ›´å¤šï¼Œè¯·è½¬åˆ° <a href="https://developer.apple.com/reference/swift?changes=latest_minor">Swift standard library diffs</a> æˆ–è€…æŸ¥çœ‹å®˜æ–¹çš„çš„<a href="https://github.com/apple/swift/blob/master/CHANGELOG.md">Swift CHANGELOG</a>ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­é˜…è¯»æ‰€æœ‰æ›´æ”¹çš„ä¿¡æ¯ã€‚æˆ–è€…æ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥äº†è§£ <strong>Swift 4.0</strong> ä¸­çš„å†…å®¹ï¼</p>

<h2 id="è‘—ä½œæƒå£°æ˜">è‘—ä½œæƒå£°æ˜</h2>

<p>æœ¬æ–‡è¯‘è‡ª <a href="https://www.raywenderlich.com/156352/whats-new-in-swift-3-1">Whatâ€™s New in Swift 3.1?</a></p>

<p>ç”±<a href="http://github.com/qiubaiying">@æŸè§(BY)</a>è¿›è¡Œç¿»è¯‘,é¦–æ¬¡å‘å¸ƒäº <a href="http://qiubaiying.github.io">BY Blog</a>ï¼Œè½¬è½½è¯·ä¿ç•™åŸæ–‡é“¾æ¥.</p>
:ET